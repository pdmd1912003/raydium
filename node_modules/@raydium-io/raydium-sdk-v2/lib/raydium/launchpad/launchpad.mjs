var qr=Object.defineProperty,Gr=Object.defineProperties;var Ur=Object.getOwnPropertyDescriptors;var Ut=Object.getOwnPropertySymbols;var xi=Object.prototype.hasOwnProperty,Ii=Object.prototype.propertyIsEnumerable;var Bi=(n,e,t)=>e in n?qr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,z=(n,e)=>{for(var t in e||(e={}))xi.call(e,t)&&Bi(n,t,e[t]);if(Ut)for(var t of Ut(e))Ii.call(e,t)&&Bi(n,t,e[t]);return n},Q=(n,e)=>Gr(n,Ur(e));var et=(n,e)=>{var t={};for(var i in n)xi.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&Ut)for(var i of Ut(n))e.indexOf(i)<0&&Ii.call(n,i)&&(t[i]=n[i]);return t};import{get as Si,set as Xr}from"lodash";var kn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ki={},zr={};function pe(n){let e=Si(Ki,n);if(!e){let t=Si(zr,n);e=new kn({name:n,logLevel:t}),Xr(Ki,n,e)}return e}import{PublicKey as bt,sendAndConfirmTransaction as Xn,SystemProgram as ys,Transaction as Mt,TransactionMessage as vt,VersionedTransaction as Et}from"@solana/web3.js";import gs from"axios";import{PublicKey as qn,AddressLookupTableAccount as ft}from"@solana/web3.js";import{PublicKey as bs}from"@solana/web3.js";import Oe from"bn.js";var ct=9e15,Ze=1e9,Tn="0123456789abcdef",zt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ht="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",hn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ct,maxE:ct,crypto:!1},Li,Ve,X=!0,jt="[DecimalError] ",He=jt+"Invalid argument: ",Fi=jt+"Precision limit exceeded",Mi=jt+"crypto unavailable",vi="[object Decimal]",fe=Math.floor,ce=Math.pow,Hr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Zr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,jr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Ei=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Re=1e7,W=7,Qr=9007199254740991,Yr=zt.length-1,Bn=Ht.length-1,T={toStringTag:vi};T.absoluteValue=T.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),v(n)};T.ceil=function(){return v(new this.constructor(this),this.e+1,2)};T.clampedTo=T.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(He+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};T.comparedTo=T.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,c=o.s,u=n.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==n.e)return o.e>n.e^c<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return i===r?0:i>r^c<0?1:-1};T.cosine=T.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+W,i.rounding=1,t=Jr(i,_i(i,t)),i.precision=n,i.rounding=e,v(Ve==2||Ve==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};T.cubeRoot=T.cbrt=function(){var n,e,t,i,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(X=!1,o=l.s*ce(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=me(l.d),n=l.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ce(t,1/3),n=fe((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new m(t),i.s=l.s):i=new m(o.toString()),s=(n=m.precision)+3;;)if(a=i,c=a.times(a).times(a),u=c.plus(l),i=$(u.plus(l).times(a),u.plus(c),s+2,1),me(a.d).slice(0,s)===(t=me(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(v(a,n+1,0),a.times(a).times(a).eq(l))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(v(i,n+1,1),e=!i.times(i).times(i).eq(l));break}return X=!0,v(i,n,m.rounding,e)};T.decimalPlaces=T.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-fe(this.e/W))*W,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};T.dividedBy=T.div=function(n){return $(this,new this.constructor(n))};T.dividedToIntegerBy=T.divToInt=function(n){var e=this,t=e.constructor;return v($(e,new t(n),0,1,1),t.precision,t.rounding)};T.equals=T.eq=function(n){return this.cmp(n)===0};T.floor=function(){return v(new this.constructor(this),this.e+1,3)};T.greaterThan=T.gt=function(n){return this.cmp(n)>0};T.greaterThanOrEqualTo=T.gte=function(n){var e=this.cmp(n);return e==1||e===0};T.hyperbolicCosine=T.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/Yt(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=lt(s,1,o.times(e),new s(1),!0);for(var c,u=n,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return v(o,s.precision=t,s.rounding=i,!0)};T.hyperbolicSine=T.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=lt(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/Yt(5,n)),r=lt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,v(r,e,t,!0)};T.hyperbolicTangent=T.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,$(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};T.inverseCosine=T.acos=function(){var n,e=this,t=e.constructor,i=e.abs().cmp(1),r=t.precision,o=t.rounding;return i!==-1?i===0?e.isNeg()?Ne(t,r,o):new t(0):new t(NaN):e.isZero()?Ne(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),n=Ne(t,r+4,o).times(.5),t.precision=r,t.rounding=o,n.minus(e))};T.inverseHyperbolicCosine=T.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,X=!1,t=t.times(t).minus(1).sqrt().plus(t),X=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};T.inverseHyperbolicSine=T.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,X=!1,t=t.times(t).plus(1).sqrt().plus(t),X=!0,i.precision=n,i.rounding=e,t.ln())};T.inverseHyperbolicTangent=T.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?v(new o(r),n,e,!0):(o.precision=t=i-r.e,r=$(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};T.inverseSine=T.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=Ne(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};T.inverseTangent=T.atan=function(){var n,e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=Bn)return s=Ne(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=Bn)return s=Ne(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/W+2|0),n=t;n;--n)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(X=!1,e=Math.ceil(a/W),i=1,c=u.times(u),s=new l(u),r=u;n!==-1;)if(r=r.times(c),o=s.minus(r.div(i+=2)),r=r.times(c),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),X=!0,v(s,l.precision=m,l.rounding=d,!0)};T.isFinite=function(){return!!this.d};T.isInteger=T.isInt=function(){return!!this.d&&fe(this.e/W)>this.d.length-2};T.isNaN=function(){return!this.s};T.isNegative=T.isNeg=function(){return this.s<0};T.isPositive=T.isPos=function(){return this.s>0};T.isZero=function(){return!!this.d&&this.d[0]===0};T.lessThan=T.lt=function(n){return this.cmp(n)<0};T.lessThanOrEqualTo=T.lte=function(n){return this.cmp(n)<1};T.logarithm=T.log=function(n){var e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(n==null)n=new l(10),e=!0;else{if(n=new l(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new l(NaN);e=n.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(X=!1,a=m+p,s=ze(u,a),i=e?Zt(l,a+10):ze(n,a),c=$(s,i,a,1),Bt(c.d,r=m,d))do if(a+=10,s=ze(u,a),i=e?Zt(l,a+10):ze(n,a),c=$(s,i,a,1),!o){+me(c.d).slice(r+1,r+15)+1==1e14&&(c=v(c,m+1,0));break}while(Bt(c.d,r+=10,d));return X=!0,v(c,m,d)};T.minus=T.sub=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,f=p.constructor;if(n=new f(n),!p.d||!n.d)return!p.s||!n.s?n=new f(NaN):p.d?n.s=-n.s:n=new f(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(u=p.d,d=n.d,a=f.precision,c=f.rounding,!u[0]||!d[0]){if(d[0])n.s=-n.s;else if(u[0])n=new f(p);else return new f(c===3?-0:0);return X?v(n,a,c):n}if(t=fe(n.e/W),l=fe(p.e/W),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),i=Math.max(Math.ceil(a/W),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=u.length,s=d.length,m=i<s,m&&(s=i),i=0;i<s;i++)if(u[i]!=d[i]){m=u[i]<d[i];break}o=0}for(m&&(e=u,u=d,d=e,n.s=-n.s),s=u.length,i=d.length-s;i>0;--i)u[s++]=0;for(i=d.length;i>o;){if(u[--i]<d[i]){for(r=i;r&&u[--r]===0;)u[r]=Re-1;--u[r],u[i]+=Re}u[i]-=d[i]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(n.d=u,n.e=Qt(u,t),X?v(n,a,c):n):new f(c===3?-0:0)};T.modulo=T.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?v(new i(t),i.precision,i.rounding):(X=!1,i.modulo==9?(e=$(t,n.abs(),0,3,1),e.s*=n.s):e=$(t,n,0,i.modulo,1),e=e.times(n),X=!0,t.minus(e))};T.naturalExponential=T.exp=function(){return xn(this)};T.naturalLogarithm=T.ln=function(){return ze(this)};T.negated=T.neg=function(){var n=new this.constructor(this);return n.s=-n.s,v(n)};T.plus=T.add=function(n){var e,t,i,r,o,s,a,c,u,l,m=this,d=m.constructor;if(n=new d(n),!m.d||!n.d)return!m.s||!n.s?n=new d(NaN):m.d||(n=new d(n.d||m.s===n.s?m:NaN)),n;if(m.s!=n.s)return n.s=-n.s,m.minus(n);if(u=m.d,l=n.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(n=new d(m)),X?v(n,a,c):n;if(o=fe(m.e/W),i=fe(n.e/W),u=u.slice(),r=o-i,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,i=o,s=u.length),o=Math.ceil(a/W),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/Re|0,u[r]%=Re;for(e&&(u.unshift(e),++i),s=u.length;u[--s]==0;)u.pop();return n.d=u,n.e=Qt(u,i),X?v(n,a,c):n};T.precision=T.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(He+n);return t.d?(e=Oi(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};T.round=function(){var n=this,e=n.constructor;return v(new e(n),n.e+1,e.rounding)};T.sine=T.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+W,i.rounding=1,t=eo(i,_i(i,t)),i.precision=n,i.rounding=e,v(Ve>2?t.neg():t,n,e,!0)):new i(NaN)};T.squareRoot=T.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(X=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=me(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=fe((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),i=new l(e)):i=new l(u.toString()),t=(c=l.precision)+3;;)if(o=i,i=o.plus($(s,o,t+2,1)).times(.5),me(o.d).slice(0,t)===(e=me(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(v(o,c+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(v(i,c+1,1),n=!i.times(i).eq(s));break}return X=!0,v(i,c,l.rounding,n)};T.tangent=T.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=$(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,v(Ve==2||Ve==4?t.neg():t,n,e,!0)):new i(NaN)};T.times=T.mul=function(n){var e,t,i,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(n=new m(n)).d;if(n.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=fe(l.e/W)+fe(n.e/W),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,i=s;i--;)o.push(0);for(i=u;--i>=0;){for(e=0,r=c+i;r>i;)a=o[r]+p[i]*d[r-i-1]+e,o[r--]=a%Re|0,e=a/Re|0;o[r]=(o[r]+e)%Re|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=Qt(o,t),X?v(n,m.precision,m.rounding):n};T.toBinary=function(n,e){return Sn(this,2,n,e)};T.toDecimalPlaces=T.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(ge(n,0,Ze),e===void 0?e=i.rounding:ge(e,0,8),v(t,n+t.e+1,e))};T.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=ve(i,!0):(ge(n,0,Ze),e===void 0?e=r.rounding:ge(e,0,8),i=v(new r(i),n+1,e),t=ve(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};T.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=ve(r):(ge(n,0,Ze),e===void 0?e=o.rounding:ge(e,0,8),i=v(new o(r),n+r.e+1,e),t=ve(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};T.toFraction=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,f=p.d,b=p.constructor;if(!f)return new b(p);if(u=t=new b(1),i=c=new b(0),e=new b(i),o=e.e=Oi(f)-p.e-1,s=o%W,e.d[0]=ce(10,s<0?W+s:s),n==null)n=o>0?e:u;else{if(a=new b(n),!a.isInt()||a.lt(u))throw Error(He+a);n=a.gt(e)?o>0?e:u:a}for(X=!1,a=new b(me(f)),l=b.precision,b.precision=o=f.length*W*2;m=$(a,e,0,1,1),r=t.plus(m.times(i)),r.cmp(n)!=1;)t=i,i=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=$(n.minus(t),i,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(i)),c.s=u.s=p.s,d=$(u,i,o,1).minus(p).abs().cmp($(c,t,o,1).minus(p).abs())<1?[u,i]:[c,t],b.precision=l,X=!0,d};T.toHexadecimal=T.toHex=function(n,e){return Sn(this,16,n,e)};T.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:ge(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(X=!1,t=$(t,n,0,e,1).times(n),X=!0,v(t)):(n.s=t.s,t=n),t};T.toNumber=function(){return+this};T.toOctal=function(n,e){return Sn(this,8,n,e)};T.toPower=T.pow=function(n){var e,t,i,r,o,s,a=this,c=a.constructor,u=+(n=new c(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new c(ce(+a,u));if(a=new c(a),a.eq(1))return a;if(i=c.precision,o=c.rounding,n.eq(1))return v(a,i,o);if(e=fe(n.e/W),e>=n.d.length-1&&(t=u<0?-u:u)<=Qr)return r=Di(c,a,t,i),n.s<0?new c(1).div(r):v(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new c(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ce(+a,u),e=t==0||!isFinite(t)?fe(u*(Math.log("0."+me(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(X=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=xn(n.times(ze(a,i+t)),i),r.d&&(r=v(r,i+5,1),Bt(r.d,i,o)&&(e=i+10,r=v(xn(n.times(ze(a,e+t)),e),e+5,1),+me(r.d).slice(i+1,i+15)+1==1e14&&(r=v(r,i+1,0)))),r.s=s,X=!0,c.rounding=o,v(r,i,o))};T.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=ve(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(ge(n,1,Ze),e===void 0?e=r.rounding:ge(e,0,8),i=v(new r(i),n,e),t=ve(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};T.toSignificantDigits=T.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(ge(n,1,Ze),e===void 0?e=i.rounding:ge(e,0,8)),v(new i(t),n,e)};T.toString=function(){var n=this,e=n.constructor,t=ve(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};T.truncated=T.trunc=function(){return v(new this.constructor(this),this.e+1,1)};T.valueOf=T.toJSON=function(){var n=this,e=n.constructor,t=ve(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function me(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=W-i.length,t&&(o+=Xe(t)),o+=i;s=n[e],i=s+"",t=W-i.length,t&&(o+=Xe(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function ge(n,e,t){if(n!==~~n||n<e||n>t)throw Error(He+n)}function Bt(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=W,r=0):(r=Math.ceil((e+1)/W),e%=W),o=ce(10,W-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==ce(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==ce(10,e-3)-1,s}function Xt(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Tn.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function Jr(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/Yt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=lt(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var $=function(){function n(i,r,o){var s,a=0,c=i.length;for(i=i.slice();c--;)s=i[c]*r+a,i[c]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(i[a]!=r[a]){c=i[a]>r[a]?1:-1;break}return c}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,c){var u,l,m,d,p,f,b,y,A,k,h,B,P,w,K,x,C,I,L,_,D=i.constructor,R=i.s==r.s?1:-1,S=i.d,N=r.d;if(!S||!S[0]||!N||!N[0])return new D(!i.s||!r.s||(S?N&&S[0]==N[0]:!N)?NaN:S&&S[0]==0||!N?R*0:R/0);for(c?(p=1,l=i.e-r.e):(c=Re,p=W,l=fe(i.e/p)-fe(r.e/p)),L=N.length,C=S.length,A=new D(R),k=A.d=[],m=0;N[m]==(S[m]||0);m++);if(N[m]>(S[m]||0)&&l--,o==null?(w=o=D.precision,s=D.rounding):a?w=o+(i.e-r.e)+1:w=o,w<0)k.push(1),f=!0;else{if(w=w/p+2|0,m=0,L==1){for(d=0,N=N[0],w++;(m<C||d)&&w--;m++)K=d*c+(S[m]||0),k[m]=K/N|0,d=K%N|0;f=d||m<C}else{for(d=c/(N[0]+1)|0,d>1&&(N=n(N,d,c),S=n(S,d,c),L=N.length,C=S.length),x=L,h=S.slice(0,L),B=h.length;B<L;)h[B++]=0;_=N.slice(),_.unshift(0),I=N[0],N[1]>=c/2&&++I;do d=0,u=e(N,h,L,B),u<0?(P=h[0],L!=B&&(P=P*c+(h[1]||0)),d=P/I|0,d>1?(d>=c&&(d=c-1),b=n(N,d,c),y=b.length,B=h.length,u=e(b,h,y,B),u==1&&(d--,t(b,L<y?_:N,y,c))):(d==0&&(u=d=1),b=N.slice()),y=b.length,y<B&&b.unshift(0),t(h,b,B,c),u==-1&&(B=h.length,u=e(N,h,L,B),u<1&&(d++,t(h,L<B?_:N,B,c))),B=h.length):u===0&&(d++,h=[0]),k[m++]=d,u&&h[0]?h[B++]=S[x]||0:(h=[S[x]],B=1);while((x++<C||h[0]!==void 0)&&w--);f=h[0]!==void 0}k[0]||k.shift()}if(p==1)A.e=l,Li=f;else{for(m=1,d=k[0];d>=10;d/=10)m++;A.e=m+l*p-1,v(A,a?o+A.e+1:o,s,f)}return A}}();function v(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor;e:if(e!=null){if(m=n.d,!m)return n;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=W,s=e,l=m[d=0],c=l/ce(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/W),a=m.length,d>=a)if(i){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=W,s=o-W+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=W,s=o-W+r,c=s<0?0:l/ce(10,r-s-1)%10|0}if(i=i||e<0||m[d+1]!==void 0||(s<0?l:l%ce(10,r-s-1)),u=t<4?(c||i)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||i||t==6&&(o>0?s>0?l/ce(10,r-s):0:m[d-1])%10&1||t==(n.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=n.e+1,m[0]=ce(10,(W-e%W)%W),n.e=-e||0):m[0]=n.e=0,n;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ce(10,W-o),m[d]=s>0?(l/ce(10,r-s)%ce(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,m[0]==Re&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Re)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return X&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function ve(n,e,t){if(!n.isFinite())return Vi(n);var i,r=n.e,o=me(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Xe(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+Xe(-r-1)+o,t&&(i=t-s)>0&&(o+=Xe(i))):r>=s?(o+=Xe(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+Xe(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=Xe(i))),o}function Qt(n,e){var t=n[0];for(e*=W;t>=10;t/=10)e++;return e}function Zt(n,e,t){if(e>Yr)throw X=!0,t&&(n.precision=t),Error(Fi);return v(new n(zt),e,1,!0)}function Ne(n,e,t){if(e>Bn)throw Error(Fi);return v(new n(Ht),e,t,!0)}function Oi(n){var e=n.length-1,t=e*W+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function Xe(n){for(var e="";n--;)e+="0";return e}function Di(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/W+4);for(X=!1;;){if(t%2&&(o=o.times(e),Ni(o.d,s)&&(r=!0)),t=fe(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Ni(e.d,s)}return X=!0,o}function Ci(n){return n.d[n.d.length-1]&1}function Wi(n,e,t){for(var i,r=new n(e[0]),o=0;++o<e.length;)if(i=new n(e[o]),i.s)r[t](i)&&(r=i);else{r=i;break}return r}function xn(n,e){var t,i,r,o,s,a,c,u=0,l=0,m=0,d=n.constructor,p=d.rounding,f=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(e==null?(X=!1,c=f):c=e,a=new d(.03125);n.e>-2;)n=n.times(a),m+=5;for(i=Math.log(ce(2,m))/Math.LN10*2+5|0,c+=i,t=o=s=new d(1),d.precision=c;;){if(o=v(o.times(n),c,1),t=t.times(++l),a=s.plus($(o,t,c,1)),me(a.d).slice(0,c)===me(s.d).slice(0,c)){for(r=m;r--;)s=v(s.times(s),c,1);if(e==null)if(u<3&&Bt(s.d,c-i,p,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return v(s,d.precision=f,p,X=!0);else return d.precision=f,s}s=a}}function ze(n,e){var t,i,r,o,s,a,c,u,l,m,d,p=1,f=10,b=n,y=b.d,A=b.constructor,k=A.rounding,h=A.precision;if(b.s<0||!y||!y[0]||!b.e&&y[0]==1&&y.length==1)return new A(y&&!y[0]?-1/0:b.s!=1?NaN:y?0:b);if(e==null?(X=!1,l=h):l=e,A.precision=l+=f,t=me(y),i=t.charAt(0),Math.abs(o=b.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)b=b.times(n),t=me(b.d),i=t.charAt(0),p++;o=b.e,i>1?(b=new A("0."+t),o++):b=new A(i+"."+t.slice(1))}else return u=Zt(A,l+2,h).times(o+""),b=ze(new A(i+"."+t.slice(1)),l-f).plus(u),A.precision=h,e==null?v(b,h,k,X=!0):b;for(m=b,c=s=b=$(b.minus(1),b.plus(1),l,1),d=v(b.times(b),l,1),r=3;;){if(s=v(s.times(d),l,1),u=c.plus($(s,new A(r),l,1)),me(u.d).slice(0,l)===me(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Zt(A,l+2,h).times(o+""))),c=$(c,new A(p),l,1),e==null)if(Bt(c.d,l-f,k,a))A.precision=l+=f,u=s=b=$(m.minus(1),m.plus(1),l,1),d=v(b.times(b),l,1),r=a=1;else return v(c,A.precision=h,k,X=!0);else return A.precision=h,c;c=u,r+=2}}function Vi(n){return String(n.s*n.s/0)}function In(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%W,t<0&&(i+=W),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=W;i<r;)n.d.push(+e.slice(i,i+=W));e=e.slice(i),i=W-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),X&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function $r(n,e){var t,i,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Ei.test(e))return In(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(Zr.test(e))t=16,e=e.toLowerCase();else if(Hr.test(e))t=2;else if(jr.test(e))t=8;else throw Error(He+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Di(i,new i(t),o,o*2)),u=Xt(e,t,Re),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new i(n.s*0):(n.e=Qt(u,l),n.d=u,X=!1,s&&(n=$(n,r,a*4)),c&&(n=n.times(Math.abs(c)<54?ce(2,c):xt.pow(2,c))),X=!0,n)}function eo(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:lt(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/Yt(5,t)),e=lt(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function lt(n,e,t,i,r){var o,s,a,c,u=1,l=n.precision,m=Math.ceil(l/W);for(X=!1,c=t.times(t),a=new n(i);;){if(s=$(a.times(c),new n(e++*e++),l,1),a=r?i.plus(s):i.minus(s),i=$(s.times(c),new n(e++*e++),l,1),s=a.plus(i),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,u++}return X=!0,s.d.length=m+1,s}function Yt(n,e){for(var t=n;--e;)t*=n;return t}function _i(n,e){var t,i=e.s<0,r=Ne(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ve=i?4:1,e;if(t=e.divToInt(r),t.isZero())Ve=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ve=Ci(t)?i?2:3:i?4:1,e;Ve=Ci(t)?i?1:4:i?3:2}return e.minus(r).abs()}function Sn(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor,f=t!==void 0;if(f?(ge(t,1,Ze),i===void 0?i=p.rounding:ge(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())l=Vi(n);else{for(l=ve(n),s=l.indexOf("."),f?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Xt(ve(d),10,r),d.e=d.d.length),m=Xt(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=f?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=m,n.e=o,n=$(n,d,t,i,0,r),m=n.d,o=n.e,u=Li),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=i<4?(s!==void 0||u)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||u||i===6&&m[t-1]&1||i===(n.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=Tn.charAt(m[s]);if(f){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=Xt(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=Tn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return n.s<0?"-"+l:l}function Ni(n,e){if(n.length>e)return n.length=e,!0}function to(n){return new this(n).abs()}function no(n){return new this(n).acos()}function io(n){return new this(n).acosh()}function ro(n,e){return new this(n).plus(e)}function oo(n){return new this(n).asin()}function so(n){return new this(n).asinh()}function ao(n){return new this(n).atan()}function uo(n){return new this(n).atanh()}function co(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=Ne(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?Ne(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=Ne(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan($(n,e,o,1)),e=Ne(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan($(n,e,o,1)),t}function lo(n){return new this(n).cbrt()}function mo(n){return v(n=new this(n),n.e+1,2)}function po(n,e,t){return new this(n).clamp(e,t)}function fo(n){if(!n||typeof n!="object")throw Error(jt+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,Ze,"rounding",0,8,"toExpNeg",-ct,0,"toExpPos",0,ct,"maxE",0,ct,"minE",-ct,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=hn[t]),(i=n[t])!==void 0)if(fe(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(He+t+": "+i);if(t="crypto",r&&(this[t]=hn[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Mi);else this[t]=!1;else throw Error(He+t+": "+i);return this}function bo(n){return new this(n).cos()}function yo(n){return new this(n).cosh()}function qi(n){var e,t,i;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,Ri(o)){u.s=o.s,X?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;X?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return In(u,o.toString())}else if(c!=="string")throw Error(He+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Ei.test(o)?In(u,o):$r(u,o)}if(r.prototype=T,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=fo,r.clone=qi,r.isDecimal=Ri,r.abs=to,r.acos=no,r.acosh=io,r.add=ro,r.asin=oo,r.asinh=so,r.atan=ao,r.atanh=uo,r.atan2=co,r.cbrt=lo,r.ceil=mo,r.clamp=po,r.cos=bo,r.cosh=yo,r.div=go,r.exp=Po,r.floor=wo,r.hypot=Ao,r.ln=ko,r.log=To,r.log10=Bo,r.log2=ho,r.max=xo,r.min=Io,r.mod=So,r.mul=Ko,r.pow=Co,r.random=No,r.round=Ro,r.sign=Lo,r.sin=Fo,r.sinh=Mo,r.sqrt=vo,r.sub=Eo,r.sum=Oo,r.tan=Do,r.tanh=Wo,r.trunc=Vo,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function go(n,e){return new this(n).div(e)}function Po(n){return new this(n).exp()}function wo(n){return v(n=new this(n),n.e+1,3)}function Ao(){var n,e,t=new this(0);for(X=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return X=!0,new this(1/0);t=e}return X=!0,t.sqrt()}function Ri(n){return n instanceof xt||n&&n.toStringTag===vi||!1}function ko(n){return new this(n).ln()}function To(n,e){return new this(n).log(e)}function ho(n){return new this(n).log(2)}function Bo(n){return new this(n).log(10)}function xo(){return Wi(this,arguments,"lt")}function Io(){return Wi(this,arguments,"gt")}function So(n,e){return new this(n).mod(e)}function Ko(n,e){return new this(n).mul(e)}function Co(n,e){return new this(n).pow(e)}function No(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:ge(n,1,Ze),i=Math.ceil(n/W),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(Mi);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=W,i&&n&&(r=ce(10,W-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=W)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<W&&(t-=W-i)}return s.e=t,s.d=a,s}function Ro(n){return v(n=new this(n),n.e+1,this.rounding)}function Lo(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Fo(n){return new this(n).sin()}function Mo(n){return new this(n).sinh()}function vo(n){return new this(n).sqrt()}function Eo(n,e){return new this(n).sub(e)}function Oo(){var n=0,e=arguments,t=new this(e[n]);for(X=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return X=!0,v(t,this.precision,this.rounding)}function Do(n){return new this(n).tan()}function Wo(n){return new this(n).tanh()}function Vo(n){return v(n=new this(n),n.e+1,1)}T[Symbol.for("nodejs.util.inspect.custom")]=T.toString;T[Symbol.toStringTag]="Decimal";var xt=T.constructor=qi(hn);zt=new xt(zt);Ht=new xt(Ht);var q=xt;import Zo from"big.js";import Aa from"bn.js";import _o from"toformat";var qo=_o,It=qo;import $t from"big.js";import Uo from"bn.js";import Xo from"decimal.js-light";import St from"bn.js";var Gi=9007199254740991;function Ee(n){let e=pe("Raydium_parseBigNumberish");if(n instanceof St)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new St(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=Gi||n<=-Gi)&&e.logWithError(`BigNumberish number overflow: ${n}`),new St(String(n))):typeof n=="bigint"?new St(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new St(0))}var Jt=pe("module/fraction"),Kn=It($t),Kt=It(Xo),zo={[0]:Kt.ROUND_DOWN,[1]:Kt.ROUND_HALF_UP,[2]:Kt.ROUND_UP},Ho={[0]:$t.roundDown,[1]:$t.roundHalfUp,[2]:$t.roundUp},ee=class{constructor(e,t=new Uo(1)){this.numerator=Ee(e),this.denominator=Ee(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new ee(this.denominator,this.numerator)}add(e){let t=e instanceof ee?e:new ee(Ee(e));return this.denominator.eq(t.denominator)?new ee(this.numerator.add(t.numerator),this.denominator):new ee(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof ee?e:new ee(Ee(e));return this.denominator.eq(t.denominator)?new ee(this.numerator.sub(t.numerator),this.denominator):new ee(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof ee?e:new ee(Ee(e));return new ee(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof ee?e:new ee(Ee(e));return new ee(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||Jt.logWithError(`${e} is not an integer.`),e<=0&&Jt.logWithError(`${e} is not positive.`),Kt.set({precision:e+1,rounding:zo[i]});let r=new Kt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||Jt.logWithError(`${e} is not an integer.`),e<0&&Jt.logWithError(`${e} is negative.`),Kn.DP=e,Kn.RM=Ho[i]||1,new Kn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Ca=pe("Raydium_amount"),Na=It(Zo);import{PublicKey as Qo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ui}from"@solana/spl-token";var Cn={chainId:101,address:Qo.default.toBase58(),programId:Ui.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},je={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ui.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Ln}from"@solana/web3.js";import{PublicKey as ne,SystemProgram as Xi,SYSVAR_RENT_PUBKEY as Yo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jo}from"@solana/spl-token";function Nn({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var Da=[Nn({pubkey:Jo,isWritable:!1}),Nn({pubkey:Xi.programId,isWritable:!1}),Nn({pubkey:Yo,isWritable:!1})];function zi({publicKey:n,transformSol:e}){let t=Hi(n.toString());if(t instanceof ne)return e&&t.equals(Ct)?en:t;if(e&&t.toString()===Ct.toBase58())return en;if(typeof t=="string"){if(t===ne.default.toBase58())return ne.default;try{return new ne(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Hi(n){try{return new ne(n)}catch{return n}}var $o=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),es=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Rn=new ne("SysvarRent111111111111111111111111111111111"),Wa=new ne("SysvarC1ock11111111111111111111111111111111"),mt=new ne("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Va=new ne("Sysvar1nstructions1111111111111111111111111"),_a=Xi.programId,qa=new ne("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ga=new ne("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ua=new ne("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Xa=new ne("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),za=new ne("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ha=new ne("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Za=new ne("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),ja=new ne("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Qa=new ne("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Ya=new ne("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ja=new ne("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),en=new ne("So11111111111111111111111111111111111111112"),Ct=ne.default;var Fn=class{constructor({mint:e,decimals:t,symbol:i,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Ct.toBase58()||e instanceof Ln&&Ct.equals(e)){this.decimals=je.decimals,this.symbol=je.symbol,this.name=je.name,this.mint=new Ln(je.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Ln.default:zi({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Qe=Fn;Qe.WSOL=new Fn(Q(z({},je),{mint:je.address}));var Mn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},tn=Mn;tn.SOL=new Mn(Cn);import ts from"bn.js";var lu=new ee(new ts(100));var yu=pe("Raydium_price");import{PublicKey as Fu}from"@solana/web3.js";import vu from"bn.js";var ns=new Oe(0),$u=new Oe(1),ec=new Oe(2),tc=new Oe(3),nc=new Oe(5),jo=new Oe(10),ic=new Oe(100),rc=new Oe(1e3),oc=new Oe(1e4);function Zi(n,e,t){return n.mul(e).add(t).sub(new Oe(1)).div(t)}function On(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}import{PublicKey as cs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ls}from"@solana/spl-token";import{ComputeBudgetProgram as ji,Keypair as Yi,PublicKey as is,Transaction as Ji,TransactionMessage as rs,VersionedTransaction as $i}from"@solana/web3.js";var tt={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as os}from"@solana/spl-token";var Qi=pe("Raydium_txUtil"),er=1644;function rn(n){let e=[],t=[];return n.microLamports&&(e.push(ji.setComputeUnitPrice({microLamports:n.microLamports})),t.push(tt.SetComputeUnitPrice)),n.units&&(e.push(ji.setComputeUnitLimit({units:n.units})),t.push(tt.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function dt(n,e){var i,r;let t=e!=null?e:"confirmed";return(r=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:t})))==null?void 0:r.blockhash}async function on(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let r=setTimeout(i,6e4);n.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}i(Object.assign(o.err,{txId:e}))},"confirmed")})}function ss(n,e){n.length<1&&Qi.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&Qi.logWithError(`no signers provided:, ${e.toString()}`);let t=new Ji;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<er}catch{return!1}}function ye(n,e){let[t,i]=is.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function Nt({instructions:n,payer:e,signers:t}){return ss(n,[e,...t])}function Rt({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=Yi.generate().publicKey.toString()}){let o=new rs({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new $i(o).serialize()).toString("base64").length<er}catch{return!1}}var as=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),us=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof $i&&(e=as(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function nt(n){let e=[];return n.forEach(t=>{t instanceof Ji&&(t.recentBlockhash||(t.recentBlockhash=os.toBase58()),t.feePayer||(t.feePayer=Yi.generate().publicKey)),e.push(us(t))}),console.log("simulate tx string:",e),e}function Le(n,e,t){return ye([n.toBuffer(),(t!=null?t:ls).toBuffer(),e.toBuffer()],new cs("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as E}from"@solana/web3.js";var Ic=new E("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Sc=new E("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Kc=new E("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Cc=new E("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Nc=new E("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Rc=new E("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Lc=new E("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Fc=new E("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Mc=new E("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),vc=new E("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ms=new E("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),ds=new E("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ps=new E("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Ec=new E("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Oc=new E("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Dc=new E("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Wc=new E("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Vc=new E("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),_c=new E("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),qc=new E("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Gc=new E("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Uc=new E("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Xc=new E("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),zc=new E("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Hc=new E("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),de=new E("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Zc=new E("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),jc=new E("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Qc=new E("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Yc=new E("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Jc=new E("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var $c={OPEN_BOOK_PROGRAM:new E("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new E("Ray1111111111111111111111111111111111111111"),AMM_V4:new E("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new E("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new E("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new E("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new E("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new E("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new E("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new E("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new E("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new E("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:E.default,Router:new E("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new E("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new E("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new E("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new E("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new E("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new E("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new E("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new E("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new E("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new E("Ray1111111111111111111111111111111111111111")};import be from"bn.js";var Lt=1e4;function Dn(n,e){let{div:t,mod:i}=n.divmod(e);return i.gt(new be(0))?t.add(new be(1)):t}function it(n,e){if(n.isZero())return new be(0);let t=n.div(e);return t.isZero()?new be(1):n.mod(e).gt(new be(0))?t.add(new be(1)):t}function Wn(n,e,t){if(e===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let i=Math.floor(t/432e3),r=i<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new be(r.maximumFee.toString()),s=i<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,a=Dn(n.mul(new be(r.transferFeeBasisPoints)),new be(Lt)),c=a.gt(o)?o:a;return{amount:n,fee:c,expirationTime:s}}function Vn(n,e,t){if(e===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let i=Math.floor(t/432e3),r=i<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new be(r.maximumFee.toString()),s=i<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(r.transferFeeBasisPoints===Lt){let a=new be(r.maximumFee.toString());return{amount:n.add(a),fee:a,expirationTime:s}}else{let a=Dn(n.mul(new be(Lt)),new be(Lt-r.transferFeeBasisPoints)),c=new be(r.maximumFee.toString()),u=a.sub(n).gt(c)?n.add(c):a,l=Dn(u.mul(new be(r.transferFeeBasisPoints)),new be(Lt)),m=l.gt(o)?o:l;return{amount:u,fee:m,expirationTime:s}}}import fs from"bn.js";var rt=new fs(1e6);import{MINT_SIZE as Rl,TOKEN_PROGRAM_ID as Ll,getTransferFeeConfig as Fl,unpackMint as Ml}from"@solana/spl-token";var _n=pe("Raydium_accountInfo_util");async function Ft(n,e,t){let{batchRequest:i,commitment:r="confirmed",chunkCount:o=100}=z({batchRequest:!1},t),s=On(e,o),a=new Array(s.length).fill([]);if(i){let c=s.map(m=>{let d=n._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=On(c,10);a=(await(await Promise.all(u.map(async m=>await n._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&_n.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:f,lamports:b,owner:y,rentEpoch:A}=d;return p.length!==2&&p[1]!=="base64"&&_n.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:f,lamports:b,owner:new bs(y),rentEpoch:A}}return null})))}else try{a=await Promise.all(s.map(c=>n.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&_n.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function _e(n,e,t){let i=await Ft(n,e.map(r=>r.pubkey),t);return e.map((r,o)=>Q(z({},r),{accountInfo:i[o]}))}async function Gn({connection:n,address:e,cluster:t="mainnet"}){let i=await Ft(n,[...new Set(e.map(o=>o.toString()))].map(o=>new qn(o))),r={};for(let o=0;o<e.length;o++){let s=i[o],a=e[o];if(!s)continue;let c=new ft({key:a,state:ft.deserialize(s.data)});r[a.toString()]=c,t==="devnet"?pt[a.toString()]=c:sn[a.toString()]=c}return r}var sn={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new ft({key:new qn("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:ft.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},pt={},Un=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(pt[e])return pt;let t=new qn(e),i=await n.getAccountInfo(t);return i&&(pt[e]=new ft({key:t,state:ft.deserialize(i.data)})),pt};var an=2e3,un=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let e=(await gs.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(i=e==null?void 0:e[15])!=null?i:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=rn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(ys.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new bt(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(tt.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==bt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(z({},t||{})):this.build(t)}build(e){var i;let t=new Mt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var l;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=r||{},u=o!=null?o:await dt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),nt([t]),(l=this.owner)!=null&&l.isKeyPair)return{txId:a?await Xn(this.connection,t,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let d of m)try{d.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:r}=this.build(i),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var A;let{sequentially:m,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:f,skipPreflight:b=!0}=l||{},y=f!=null?f:await dt(this.connection,this.blockhashCommitment);if((A=this.owner)!=null&&A.isKeyPair){if(m){let k=[],h=0;for(let B of s){if(++h,h<=p)continue;let P=await Xn(this.connection,B,this.signers.find(w=>w.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});k.push(P)}return{txIds:k,signedTxs:s}}return{txIds:await await Promise.all(s.map(async k=>(k.recentBlockhash=y,await this.connection.sendRawTransaction(k.serialize(),{skipPreflight:b})))),signedTxs:s}}if(this.signAllTransactions){let k=s.map((B,P)=>(B.recentBlockhash=y,a[P].length&&B.sign(...a[P]),B));nt(k);let h=await this.signAllTransactions(k);if(m){let B=0,P=[],w=async()=>{if(!h[B])return;let K=await this.connection.sendRawTransaction(h[B].serialize(),{skipPreflight:b});P.push({txId:K,status:"sent",signedTx:h[B]}),d==null||d([...P]),B++;let x=!1,C=null,I=null,L=_=>{C!==null&&clearInterval(C),I!==null&&this.connection.removeSignatureListener(I);let D=P.findIndex(R=>R.txId===K);if(D>-1){if(P[D].status==="error"||P[D].status==="success")return;P[D].status=_.err?"error":"success"}d==null||d([...P]),_.err||w()};this.loopMultiTxStatus&&(C=setInterval(async()=>{var _;if(x){clearInterval(C);return}try{let D=await this.connection.getTransaction(K,{commitment:"confirmed",maxSupportedTransactionVersion:0});D&&(x=!0,clearInterval(C),L({err:((_=D.meta)==null?void 0:_.err)||null}),console.log("tx status from getTransaction:",K))}catch(D){x=!0,clearInterval(C),console.error("getTransaction timeout:",D,K)}},an)),I=this.connection.onSignature(K,_=>{if(x){this.connection.removeSignatureListener(I);return}x=!0,L(_)},"confirmed"),this.connection.getSignatureStatus(K)};return await w(),{txIds:P.map(K=>K.txId),signedTxs:h}}else{let B=[];for(let P=0;P<h.length;P+=1){let w=await this.connection.sendRawTransaction(h[P].serialize(),{skipPreflight:b});B.push(w)}return{txIds:B,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e){var b;let f=e||{},{lookupTableCache:t={},lookupTableAddress:i=[],forerunCreate:r,recentBlockhash:o}=f,s=et(f,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=z(z({},this.cluster==="devnet"?await Un(this.connection):sn),t),c=Array.from(new Set([...i,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new bt(y));let l=await Gn({connection:this.connection,address:u});for(let[y,A]of Object.entries(l))a[y]=A;let m=r?bt.default.toBase58():o!=null?o:await dt(this.connection,this.blockhashCommitment),d=new vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((b=this.owner)==null?void 0:b.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Et(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var B;let{skipPreflight:A=!0,sendAndConfirm:k,notSendToRpc:h}=y||{};if(nt([p]),(B=this.owner)!=null&&B.isKeyPair){let P=await this.connection.sendTransaction(p,{skipPreflight:A});return k&&await on(this.connection,P),{txId:P,signedTx:p}}if(this.signAllTransactions){let P=await this.signAllTransactions([p]);if(this.signers.length)for(let w of P)try{w.sign(this.signers)}catch{}return{txId:h?"":await this.connection.sendTransaction(P[0],{skipPreflight:A}),signedTx:P[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:r}=await this.buildV0(i),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:i,execute:async l=>{var b;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:f=!0}=l||{};if(p&&s.forEach(y=>y.message.recentBlockhash=p),nt(s),(b=this.owner)!=null&&b.isKeyPair){if(m){let y=[];for(let A of s){let k=await this.connection.sendTransaction(A,{skipPreflight:f});await on(this.connection,k),y.push(k)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:f}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(m){let A=0,k=[],h=async()=>{if(!y[A])return;let B=await this.connection.sendTransaction(y[A],{skipPreflight:f});k.push({txId:B,status:"sent",signedTx:y[A]}),d==null||d([...k]),A++;let P=!1,w=null,K=null,x=C=>{w!==null&&clearInterval(w),K!==null&&this.connection.removeSignatureListener(K);let I=k.findIndex(L=>L.txId===B);if(I>-1){if(k[I].status==="error"||k[I].status==="success")return;k[I].status=C.err?"error":"success"}d==null||d([...k]),C.err||h()};this.loopMultiTxStatus&&(w=setInterval(async()=>{var C;if(P){clearInterval(w);return}try{let I=await this.connection.getTransaction(B,{commitment:"confirmed",maxSupportedTransactionVersion:0});I&&(P=!0,clearInterval(w),x({err:((C=I.meta)==null?void 0:C.err)||null}),console.log("tx status from getTransaction:",B))}catch(I){P=!0,clearInterval(w),console.error("getTransaction timeout:",I,B)}},an)),K=this.connection.onSignature(B,C=>{if(P){this.connection.removeSignatureListener(K);return}P=!0,x(C)},"confirmed"),this.connection.getSignatureStatus(B)};return h(),{txIds:[],signedTxs:y}}else{let A=[];for(let k=0;k<y.length;k+=1){let h=await this.connection.sendTransaction(y[k],{skipPreflight:f});A.push(h)}return{txIds:A,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){var d;let m=e||{},{splitIns:t=[],computeBudgetConfig:i}=m,r=et(m,["splitIns","computeBudgetConfig"]),o=i?rn(i):{instructions:[],instructionTypes:[]},s=this.signers.reduce((p,f)=>Q(z({},p),{[f.publicKey.toBase58()]:f}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(p=>{let f=[...u,p],b=i?[...o.instructions,...f]:f,A=[...new Set(f.map(k=>k.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(k=>new bt(k));if(p!==t[l]&&u.length<12&&(Nt({instructions:b,payer:this.feePayer,signers:A})||Nt({instructions:f,payer:this.feePayer,signers:A})))u.push(p);else{if(u.length===0)throw Error("item ins too big");l+=p===t[l]?1:0,Nt({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:A})?a.push(new Mt().add(...o.instructions,...u)):a.push(new Mt().add(...u)),c.push(Array.from(new Set(u.map(k=>k.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat())).map(k=>s[k]).filter(k=>k!==void 0)),u=[p]}}),u.length>0){let f=[...new Set(u.map(b=>b.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(b=>s[b]).filter(b=>b!==void 0);Nt({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:f.map(b=>b.publicKey)})?a.push(new Mt().add(...o.instructions,...u)):a.push(new Mt().add(...u)),c.push(f)}return a.forEach(p=>p.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&c.forEach(p=>{p.some(f=>f.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async p=>{var B;let{sequentially:f,onTxUpdate:b,skipTxCount:y=0,recentBlockHash:A,skipPreflight:k=!0}=p||{},h=A!=null?A:await dt(this.connection,this.blockhashCommitment);if(a.forEach(async(P,w)=>{P.recentBlockhash=h,c[w].length&&P.sign(...c[w])}),nt(a),(B=this.owner)!=null&&B.isKeyPair){if(f){let P=0,w=[];for(let K of a){if(++P,P<=y){w.push("tx skipped");continue}let x=await Xn(this.connection,K,this.signers.find(C=>C.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:k});w.push(x)}return{txIds:w,signedTxs:a}}return{txIds:await Promise.all(a.map(async P=>await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:k}))),signedTxs:a}}if(this.signAllTransactions){let P=await this.signAllTransactions(a.slice(y,a.length)),w=[...a.slice(0,y),...P];if(f){let K=0,x=[],C=async()=>{if(!w[K])return;K<y&&(x.push({txId:"",status:"success",signedTx:w[K]}),b==null||b([...x]),K++,C());let I=await this.connection.sendRawTransaction(w[K].serialize(),{skipPreflight:k});x.push({txId:I,status:"sent",signedTx:w[K]}),b==null||b([...x]),K++;let L=!1,_=null,D=null,R=S=>{_!==null&&clearInterval(_),D!==null&&this.connection.removeSignatureListener(D);let N=x.findIndex(J=>J.txId===I);if(N>-1){if(x[N].status==="error"||x[N].status==="success")return;x[N].status=S.err?"error":"success"}b==null||b([...x]),S.err||C()};this.loopMultiTxStatus&&(_=setInterval(async()=>{var S;if(L){clearInterval(_);return}try{let N=await this.connection.getTransaction(I,{commitment:"confirmed",maxSupportedTransactionVersion:0});N&&(L=!0,clearInterval(_),R({err:((S=N.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",I))}catch(N){L=!0,clearInterval(_),console.error("getTransaction timeout:",N,I)}},an)),D=this.connection.onSignature(I,S=>{if(L){this.connection.removeSignatureListener(D);return}L=!0,R(S)},"confirmed"),this.connection.getSignatureStatus(I)};return await C(),{txIds:x.map(I=>I.txId),signedTxs:w}}else{let K=[];for(let x=0;x<w.length;x+=1){let C=await this.connection.sendRawTransaction(w[x].serialize(),{skipPreflight:k});K.push(C)}return{txIds:K,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var h;let k=e||{},{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:r={},lookupTableAddress:o=[]}=k,s=et(k,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=z(z({},this.cluster==="devnet"?await Un(this.connection):sn),r),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let B of c)a[B]===void 0&&u.push(new bt(B));let l=await Gn({connection:this.connection,address:u});for(let[B,P]of Object.entries(l))a[B]=P;let m=t?rn(t):{instructions:[],instructionTypes:[]},d=await dt(this.connection,this.blockhashCommitment),p=this.signers.reduce((B,P)=>Q(z({},B),{[P.publicKey.toBase58()]:P}),{}),f=[],b=[],y=[],A=0;if(this.allInstructions.forEach(B=>{let P=[...y,B],w=t?[...m.instructions,...P]:P;if(B!==i[A]&&y.length<12&&(Rt({instructions:w,payer:this.feePayer,lookupTableAddressAccount:a})||Rt({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})))y.push(B);else{if(y.length===0)throw Error("item ins too big");A+=B===i[A]?1:0;let K={};for(let x of[...new Set(c)])a[x]!==void 0&&(K[x]=a[x]);if(t&&Rt({instructions:[...m.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let x=new vt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...y]}).compileToV0Message(Object.values(a));f.push(new Et(x))}else{let x=new vt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(a));f.push(new Et(x))}b.push(Array.from(new Set(y.map(x=>x.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(x=>p[x]).filter(x=>x!==void 0)),y=[B]}}),y.length>0){let P=[...new Set(y.map(w=>w.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat()).values()].map(w=>p[w]).filter(w=>w!==void 0);if(t&&Rt({instructions:[...m.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let w=new vt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...y]}).compileToV0Message(Object.values(a));f.push(new Et(w))}else{let w=new vt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(a));f.push(new Et(w))}b.push(P)}return(h=this.owner)!=null&&h.signer&&b.forEach(B=>{B.some(P=>P.publicKey.equals(this.owner.publicKey))||B.push(this.owner.signer)}),f.forEach((B,P)=>{B.sign(b[P])}),{builder:this,transactions:f,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async B=>{var I;let{sequentially:P,onTxUpdate:w,skipTxCount:K=0,recentBlockHash:x,skipPreflight:C=!0}=B||{};if(f.map(async(L,_)=>{b[_].length&&L.sign(b[_]),x&&(L.message.recentBlockhash=x)}),nt(f),(I=this.owner)!=null&&I.isKeyPair){if(P){let L=0,_=[];for(let D of f){if(++L,L<=K){console.log("skip tx: ",L),_.push("tx skipped");continue}let R=await this.connection.sendTransaction(D,{skipPreflight:C});await on(this.connection,R),_.push(R)}return{txIds:_,signedTxs:f}}return{txIds:await Promise.all(f.map(async L=>await this.connection.sendTransaction(L,{skipPreflight:C}))),signedTxs:f}}if(this.signAllTransactions){let L=await this.signAllTransactions(f.slice(K,f.length)),_=[...f.slice(0,K),...L];if(P){let D=0,R=[],S=async()=>{if(!_[D])return;if(D<K){R.push({txId:"",status:"success",signedTx:_[D]}),w==null||w([...R]),D++,S();return}let N=await this.connection.sendTransaction(_[D],{skipPreflight:C});R.push({txId:N,status:"sent",signedTx:_[D]}),w==null||w([...R]),D++;let J=!1,te=null,Y=null,ue=se=>{te!==null&&clearInterval(te),Y!==null&&this.connection.removeSignatureListener(Y);let re=R.findIndex(ae=>ae.txId===N);if(re>-1){if(R[re].status==="error"||R[re].status==="success")return;R[re].status=se.err?"error":"success"}w==null||w([...R]),se.err||S()};this.loopMultiTxStatus&&(te=setInterval(async()=>{var se;if(J){clearInterval(te);return}try{let re=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});re&&(J=!0,clearInterval(te),ue({err:((se=re.meta)==null?void 0:se.err)||null}),console.log("tx status from getTransaction:",N))}catch(re){J=!0,clearInterval(te),console.error("getTransaction timeout:",re,N)}},an)),Y=this.connection.onSignature(N,se=>{if(J){this.connection.removeSignatureListener(Y);return}J=!0,ue(se)},"confirmed"),this.connection.getSignatureStatus(N)};return S(),{txIds:[],signedTxs:_}}else{let D=[];for(let R=0;R<_.length;R+=1){let S=await this.connection.sendTransaction(_[R],{skipPreflight:C});D.push(S)}return{txIds:D,signedTxs:_}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var zn=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),yt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=pe(t)}createTxBuilder(e){return this.scope.checkOwner(),new un({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(zn(e))}logInfo(...e){this.logger.info(zn(e))}logAndCreateError(...e){let t=zn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as Vf}from"@solana/web3.js";import qf from"bn.js";import{AccountLayout as zf,createAssociatedTokenAccountIdempotentInstruction as Hf,TOKEN_2022_PROGRAM_ID as Zf,TOKEN_PROGRAM_ID as jf}from"@solana/spl-token";import{PublicKey as rm}from"@solana/web3.js";import{MintLayout as sm,TOKEN_PROGRAM_ID as um}from"@solana/spl-token";import{Keypair as lf,PublicKey as mf,SystemProgram as pf,TransactionInstruction as ff}from"@solana/web3.js";import yf from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as wf,TOKEN_2022_PROGRAM_ID as Af,TOKEN_PROGRAM_ID as kf}from"@solana/spl-token";import{PublicKey as Ks}from"@solana/web3.js";import ur,{isBN as cr}from"bn.js";import{bits as bm,BitStructure as ym,blob as Ps,Blob as gm,cstr as Pm,f32 as wm,f32be as Am,f64 as km,f64be as Tm,greedy as hm,Layout as ws,ns64 as Bm,ns64be as xm,nu64 as Im,nu64be as Sm,offset as As,s16 as Km,s16be as Cm,s24 as Nm,s24be as Rm,s32 as ks,s32be as Lm,s40 as Fm,s40be as Mm,s48 as vm,s48be as Em,s8 as Om,seq as Ts,struct as Dm,Structure as hs,u16 as Bs,u16be as Wm,u24 as Vm,u24be as _m,u32 as xs,u32be as qm,u40 as Gm,u40be as Um,u48 as Xm,u48be as zm,u8 as Is,UInt as Ss,union as Hm,Union as Zm,unionLayoutDiscriminator as jm,utf8 as Qm}from"@solana/buffer-layout";var Hn=ws,ir=hs;var Zn=Ss;var rr=Is,qe=Bs;var or=xs;var Ge=ks;var sr=Ts;var Pe=Ps;var ar=As;var gt=class extends Hn{constructor(t,i,r){super(t,r);this.blob=Pe(t),this.signed=i}decode(t,i=0){let r=new ur(this.blob.decode(t,i),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,i,r=0){return typeof t=="number"&&(t=new ur(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),i,r)}};function G(n){return new Zn(1,n)}function wt(n){return new Zn(4,n)}function g(n){return new gt(8,!1,n)}function ie(n){return new gt(16,!1,n)}function lr(n){return new gt(8,!0,n)}function mr(n){return new gt(16,!0,n)}var Pt=class extends Hn{constructor(t,i,r,o){super(t.span,o);this.layout=t,this.decoder=i,this.encoder=r}decode(t,i){return this.decoder(this.layout.decode(t,i))}encode(t,i,r){return this.layout.encode(this.encoder(t),i,r)}getSpan(t,i){return this.layout.getSpan(t,i)}};function O(n){return new Pt(Pe(32),e=>new Ks(e),e=>e.toBuffer(),n)}function Qn(n){return new Pt(rr(),Cs,Ns,n)}function Cs(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function Ns(n){return n?1:0}function Rs(n){let e=or("length"),t=U([e,Pe(ar(e,-e.span),"data")]);return new Pt(t,({data:i})=>i,i=>({data:i}),n)}function we(n){return new Pt(Rs(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),n)}var jn=class extends ir{decode(e,t){return super.decode(e,t)}};function U(n,e,t){return new jn(n,e,t)}function j(n,e,t){let i,r=typeof e=="number"?e:cr(e)?e.toNumber():new Proxy(e,{get(o,s){if(!i){let a=Reflect.get(o,"count");i=cr(a)?a.toNumber():a,Reflect.set(o,"count",i)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(i=a),Reflect.set(o,s,a)}});return sr(n,r,t)}import Gp from"bn.js";import Be from"bn.js";var Yn=new Be(0),dr=new Be(1),pr=new Be(-1),De=new Be(1).shln(64),fr=new Be(1).shln(128),Jn=De.sub(dr);var Ls=fr.subn(1),At=-443636,Ot=-At,$n=new Be("4295048016"),ei=new Be("79226673521066979257578248091"),ud=new Be("4295048017"),cd=new Be("79226673521066979257578248090");var Fs=new Be(10).pow(new Be(6));var ld=new Be("18446744073700000000");import Cp from"bn.js";var yd=Buffer.from("amm_config","utf8"),br=Buffer.from("pool","utf8"),yr=Buffer.from("pool_vault","utf8"),gd=Buffer.from("pool_reward_vault","utf8"),Pd=Buffer.from("position","utf8"),wd=Buffer.from("tick_array","utf8"),Ad=Buffer.from("operation","utf8"),kd=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Td=Buffer.from("observation","utf8");function ti(n){return ye([Buffer.from("metadata","utf8"),mt.toBuffer(),n.toBuffer()],mt)}var hd=Buffer.from("locked_position","utf8");var Bd=Buffer.from("support_mint","utf8");import{PublicKey as ip}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as op}from"@solana/spl-token";import ap from"bn.js";import Sd from"bn.js";var ri=14;var cn=60;var Ds=U([Pe(8),G("bump"),qe("index"),O(""),wt("protocolFeeRate"),wt("tradeFeeRate"),qe("tickSpacing"),j(g(),8,"")]),Ws=U([wt("blockTimestamp"),lr("tickCumulative"),j(g(),4)]),Ir=U([Pe(8),Qn("initialized"),g("recentEpoch"),qe("observationIndex"),O("poolId"),j(Ws,100,"observations"),j(g(),4)]),Vs=U([G("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),ie("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),O("tokenMint"),O("tokenVault"),O("creator"),ie("rewardGrowthGlobalX64")]),hr=U([Pe(8),G("bump"),O("ammConfig"),O("creator"),O("mintA"),O("mintB"),O("vaultA"),O("vaultB"),O("observationId"),G("mintDecimalsA"),G("mintDecimalsB"),qe("tickSpacing"),ie("liquidity"),ie("sqrtPriceX64"),Ge("tickCurrent"),wt(),ie("feeGrowthGlobalX64A"),ie("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),ie("swapInAmountTokenA"),ie("swapOutAmountTokenB"),ie("swapInAmountTokenB"),ie("swapOutAmountTokenA"),G("status"),j(G(),7,""),j(Vs,3,"rewardInfos"),j(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),j(g(),15*4-3,"padding")]),_s=U([ie("growthInsideLastX64"),g("rewardAmountOwed")]),Br=U([Pe(8),G("bump"),O("nftMint"),O("poolId"),Ge("tickLower"),Ge("tickUpper"),ie("liquidity"),ie("feeGrowthInsideLastX64A"),ie("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),j(_s,3,"rewardInfos"),j(g(),8,"")]),$p=U([Pe(8),G("bump"),O("poolId"),Ge("tickLowerIndex"),Ge("tickUpperIndex"),ie("liquidity"),ie("feeGrowthInsideLastX64A"),ie("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),j(ie(),3,"rewardGrowthInside"),j(g(),8,"")]),qs=U([Ge("tick"),mr("liquidityNet"),ie("liquidityGross"),ie("feeGrowthOutsideX64A"),ie("feeGrowthOutsideX64B"),j(ie(),3,"rewardGrowthsOutsideX64"),j(wt(),13,"")]),Ar=U([Pe(8),O("poolId"),Ge("startTickIndex"),j(qs,cn,"ticks"),G("initializedTickCount"),j(G(),115,"")]),Gs=U([Pe(329),j(O(),100,"whitelistMints")]),Os=U([Pe(8),O("poolId"),j(j(g(),8),ri,"positiveTickArrayBitmap"),j(j(g(),8),ri,"negativeTickArrayBitmap")]),ef=U([g(),G("bump"),O("owner"),O("poolId"),O("positionId"),O("nftAccount"),j(g(),8)]),Us=U([Pe(8),G("bump"),O("lockOwner"),O("poolId"),O("positionId"),O("nftAccount"),O("lockNftMint"),g("recentEpoch"),j(g(),8)]);Ir.span;var Nf=pe("Raydium_Clmm");var Zs=Buffer.from("vault_auth_seed","utf8"),Mb=Buffer.from("global_config","utf8"),js=Buffer.from("pool_vesting","utf8"),Qs=Buffer.from("platform_config","utf8"),Ys=Buffer.from("platform_fee_vault_auth_seed","utf8"),Js=Buffer.from("creator_fee_vault_auth_seed","utf8");function We(n){return ye([Zs],n)}function kt(n,e,t){return ye([br,e.toBuffer(),t.toBuffer()],n)}function oi(n,e,t){return ye([yr,e.toBuffer(),t.toBuffer()],n)}function ot(n){return ye([Buffer.from("__event_authority","utf8")],n)}function si(n,e){return ye([Qs,e.toBuffer()],n)}function Vt(n,e,t){return ye([js,e.toBuffer(),t.toBuffer()],n)}function st(n,e,t){return ye([e.toBuffer(),t.toBuffer()],n)}function ai(n){return ye([Ys],n)}function Tt(n,e,t){return ye([e.toBuffer(),t.toBuffer()],n)}function Sr(n){return ye([Js],n)}import{SystemProgram as xe,TransactionInstruction as Te}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ln,TOKEN_2022_PROGRAM_ID as $s,TOKEN_PROGRAM_ID as ui}from"@solana/spl-token";import _t from"bn.js";var he={initialize:Buffer.from([175,175,109,31,13,152,155,237]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143]),initializeWithToken2022:Buffer.from([37,190,126,222,44,154,171,17]),claimPlatformFeeFromVault:Buffer.from([117,241,198,168,248,218,80,29]),claimCreatorFee:Buffer.from([26,97,138,203,132,171,141,252])};function Kr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,y,A,k,h){let B=U([G("decimals"),we("name"),we("symbol"),we("uri")]),P=U([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod")]),w=U([G("index"),g("supply"),g("totalFundRaisingB"),G("migrateType")]),K=U([G("index"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),G("migrateType")]),x=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ui,isSigner:!1,isWritable:!1},{pubkey:ui,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:Rn,isSigner:!1,isWritable:!1},{pubkey:ot(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}],C=Buffer.alloc(Buffer.from(p,"utf-8").length+Buffer.from(f,"utf-8").length+Buffer.from(b,"utf-8").length+4*3+1),I=Buffer.alloc(P.span),L=Buffer.alloc(y.type==="ConstantCurve"?K.span:w.span);return B.encode({decimals:d,name:p,symbol:f,uri:b},C),y.type==="ConstantCurve"?K.encode(Q(z({index:0},y),{migrateType:y.migrateType==="amm"?0:1}),L):y.type==="FixedCurve"?w.encode(Q(z({index:1},y),{migrateType:y.migrateType==="amm"?0:1}),L):y.type==="LinearCurve"&&w.encode(Q(z({index:2},y),{migrateType:y.migrateType==="amm"?0:1}),L),P.encode({totalLockedAmount:A,cliffPeriod:k,unlockPeriod:h},I),new Te({keys:x,programId:n,data:Buffer.from([...he.initialize,...C,...L,...I])})}function Cr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,y,A,k,h){let B=U([G("decimals"),we("name"),we("symbol"),we("uri")]),P=U([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),G("transferFeeExtensionParamsOption"),U([qe("transferFeeBasePoints"),g("maxinumFee")]).replicate("transferFeeExtensionParams")]),w=U([G("index"),g("supply"),g("totalFundRaisingB"),G("migrateType")]),K=U([G("index"),g("supply"),g("totalSellA"),g("totalFundRaisingB"),G("migrateType")]),x=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:$s,isSigner:!1,isWritable:!1},{pubkey:ui,isSigner:!1,isWritable:!1},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:ot(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}],C=Buffer.alloc(Buffer.from(d,"utf-8").length+Buffer.from(p,"utf-8").length+Buffer.from(f,"utf-8").length+4*3+1),I=Buffer.alloc(P.span),L=Buffer.alloc(b.type==="ConstantCurve"?K.span:w.span);return B.encode({decimals:m,name:d,symbol:p,uri:f},C),b.type==="ConstantCurve"?K.encode(Q(z({index:0},b),{migrateType:b.migrateType==="amm"?0:1}),L):b.type==="FixedCurve"?w.encode(Q(z({index:1},b),{migrateType:b.migrateType==="amm"?0:1}),L):b.type==="LinearCurve"&&w.encode(Q(z({index:2},b),{migrateType:b.migrateType==="amm"?0:1}),L),P.encode({totalLockedAmount:y,cliffPeriod:A,unlockPeriod:k,transferFeeExtensionParamsOption:h?1:0,transferFeeExtensionParams:h!=null?h:{transferFeeBasePoints:0,maxinumFee:new _t(0)}},I),new Te({keys:x,programId:n,data:Buffer.from([...he.initializeWithToken2022,...C,...L,...I])})}function Nr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,y,A,k,h){let B=U([g("amountB"),g("minAmountA"),g("shareFeeRate")]),P=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ot(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&P.push({pubkey:h,isSigner:!1,isWritable:!0}),P.push({pubkey:xe.programId,isSigner:!1,isWritable:!1}),P.push({pubkey:f,isSigner:!1,isWritable:!0}),P.push({pubkey:b,isSigner:!1,isWritable:!0});let w=Buffer.alloc(B.span);return B.encode({amountB:y,minAmountA:A,shareFeeRate:k!=null?k:new _t(0)},w),new Te({keys:P,programId:n,data:Buffer.from([...he.buyExactIn,...w])})}function Rr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,y,A,k,h){let B=U([g("amountA"),g("maxAmountB"),g("shareFeeRate")]),P=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ot(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&P.push({pubkey:h,isSigner:!1,isWritable:!0}),P.push({pubkey:xe.programId,isSigner:!1,isWritable:!1}),P.push({pubkey:f,isSigner:!1,isWritable:!0}),P.push({pubkey:b,isSigner:!1,isWritable:!0});let w=Buffer.alloc(B.span);return B.encode({amountA:y,maxAmountB:A,shareFeeRate:k!=null?k:new _t(0)},w),new Te({keys:P,programId:n,data:Buffer.from([...he.buyExactOut,...w])})}function Lr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,y,A,k,h){let B=U([g("amountA"),g("minAmountB"),g("shareFeeRate")]),P=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ot(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&P.push({pubkey:h,isSigner:!1,isWritable:!0}),P.push({pubkey:xe.programId,isSigner:!1,isWritable:!1}),P.push({pubkey:f,isSigner:!1,isWritable:!0}),P.push({pubkey:b,isSigner:!1,isWritable:!0});let w=Buffer.alloc(B.span);return B.encode({amountA:y,minAmountB:A,shareFeeRate:k!=null?k:new _t(0)},w),new Te({keys:P,programId:n,data:Buffer.from([...he.sellExactIn,...w])})}function Fr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,y,A,k,h){let B=U([g("amountB"),g("maxAmountA"),g("shareFeeRate")]),P=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ot(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&P.push({pubkey:h,isSigner:!1,isWritable:!0}),P.push({pubkey:xe.programId,isSigner:!1,isWritable:!1}),P.push({pubkey:f,isSigner:!1,isWritable:!0}),P.push({pubkey:b,isSigner:!1,isWritable:!0});let w=Buffer.alloc(B.span);return B.encode({amountB:y,maxAmountA:A,shareFeeRate:k!=null?k:new _t(0)},w),new Te({keys:P,programId:n,data:Buffer.from([...he.sellExactOut,...w])})}function ci(n,e,t,i,r,o,s,a,c){let u=U([]),l=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);return u.encode({},m),new Te({keys:l,programId:n,data:Buffer.from([...he.claimVestedToken,...m])})}function li(n,e,t,i,r,o){let s=U([g("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:xe.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:o},c),new Te({keys:a,programId:n,data:Buffer.from([...he.createVestingAccount,...c])})}function mi(n,e,t,i,r,o,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:xe.programId,isSigner:!1,isWritable:!0},{pubkey:ln,isSigner:!1,isWritable:!0}];return new Te({keys:u,programId:n,data:he.claimPlatformFee})}function Mr(n,e,t,i,r,o,s,a,c,u,l,m,d){let p=U([g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),we("name"),we("web"),we("img"),g("creatorFeeRate")]),f=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1}],b=Buffer.alloc(8*5+Buffer.from(l,"utf-8").length+Buffer.from(m,"utf-8").length+Buffer.from(d,"utf-8").length+4*3);return p.encode({platformScale:a.platformScale,creatorScale:a.creatorScale,burnScale:a.burnScale,feeRate:c,name:l,web:m,img:d,creatorFeeRate:u},b),new Te({keys:f,programId:n,data:Buffer.from([...he.createPlatformConfig,...b])})}function vr(n,e,t,i){let r=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],o;if(i.type==="updateClaimFeeWallet"){let s=U([G("index"),O("value")]);o=Buffer.alloc(s.span),s.encode({index:0,value:i.value},o)}else if(i.type==="updateLockNftWallet"){let s=U([G("index"),O("value")]);o=Buffer.alloc(s.span),s.encode({index:1,value:i.value},o)}else if(i.type==="migrateCpLockNftScale"){let s=U([G("index"),g("platformScale"),g("creatorScale"),g("burnScale")]);o=Buffer.alloc(s.span),s.encode(z({index:2},i.value),o)}else if(i.type==="updateFeeRate"){let s=U([G("index"),g("value")]);o=Buffer.alloc(s.span),s.encode({index:3,value:i.value},o)}else if(i.type==="updateImg"||i.type==="updateName"||i.type==="updateWeb"){let s=U([G("index"),we("value")]);o=Buffer.alloc(Buffer.from(i.value,"utf-8").length+4+1*1),i.type==="updateName"?s.encode({index:4,value:i.value},o):i.type==="updateWeb"?s.encode({index:5,value:i.value},o):i.type==="updateImg"&&s.encode({index:6,value:i.value},o)}else if(i.type==="updateCpConfigId"){r.push({pubkey:i.value,isSigner:!1,isWritable:!1});let s=U([G("index")]);o=Buffer.alloc(s.span),s.encode({index:7},o)}else if(i.type==="updateAll"){r.push({pubkey:i.value.cpConfigId,isSigner:!1,isWritable:!1});let s=U([G("index"),O("platformClaimFeeWallet"),O("platformLockNftWallet"),g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),we("name"),we("web"),we("img"),O("transferFeeExtensionAuth"),g("creatorFeeRate")]);o=Buffer.alloc(1+32+32+8*4+4*3+Buffer.from(i.value.name,"utf-8").length+Buffer.from(i.value.web,"utf-8").length+Buffer.from(i.value.img,"utf-8").length),s.encode({index:8,platformClaimFeeWallet:i.value.platformClaimFeeWallet,platformLockNftWallet:i.value.platformLockNftWallet,platformScale:i.value.migrateCpLockNftScale.platformScale,creatorScale:i.value.migrateCpLockNftScale.creatorScale,burnScale:i.value.migrateCpLockNftScale.burnScale,feeRate:i.value.feeRate,name:i.value.name,web:i.value.web,img:i.value.img,transferFeeExtensionAuth:i.value.transferFeeExtensionAuth,creatorFeeRate:i.value.creatorFeeRate},o)}else throw Error("updateInfo params type error");return new Te({keys:r,programId:n,data:Buffer.from([...he.updatePlaformConfig,...o])})}function di(n,e,t,i,r,o,s,a){let c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1}];return new Te({keys:c,programId:n,data:he.claimPlatformFeeFromVault})}function Er(n,e,t,i,r,o,s){let a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1}];return new Te({keys:a,programId:n,data:he.claimCreatorFee})}import{NATIVE_MINT as Ue,TOKEN_2022_PROGRAM_ID as at,TOKEN_PROGRAM_ID as oe,createAssociatedTokenAccountIdempotentInstruction as Ke,getTransferFeeConfig as yn,unpackMint as gn}from"@solana/spl-token";import V from"bn.js";import{PublicKey as Dr}from"@solana/web3.js";var Ye=U([g(),g("epoch"),G("curveType"),qe("index"),g("migrateFee"),g("tradeFeeRate"),g("maxShareFeeRate"),g("minSupplyA"),g("maxLockRate"),g("minSellRateA"),g("minMigrateRateA"),g("minFundRaisingB"),O("mintB"),O("protocolFeeOwner"),O("migrateFeeOwner"),O("migrateToAmmWallet"),O("migrateToCpmmWallet"),j(g(),16)]),ea=U([g("totalLockedAmount"),g("cliffPeriod"),g("unlockPeriod"),g("startTime"),g("totalAllocatedShare")]),Fe=U([g(),g("epoch"),G("bump"),G("status"),G("mintDecimalsA"),G("mintDecimalsB"),G("migrateType"),g("supply"),g("totalSellA"),g("virtualA"),g("virtualB"),g("realA"),g("realB"),g("totalFundRaisingB"),g("protocolFee"),g("platformFee"),g("migrateFee"),ea.replicate("vestingSchedule"),O("configId"),O("platformId"),O("mintA"),O("mintB"),O("vaultA"),O("vaultB"),O("creator"),G("mintProgramFlag"),j(G(),63)]),zb=U([g(),g("epoch"),O("poolId"),O("beneficiary"),g("claimedAmount"),g("tokenShareAmount"),j(g(),8)]),ht=U([g(),g("epoch"),O("platformClaimFeeWallet"),O("platformLockNftWallet"),g("platformScale"),g("creatorScale"),g("burnScale"),g("feeRate"),j(G(),64,"name"),j(G(),256,"web"),j(G(),256,"img"),O("cpConfigId"),g("creatorFeeRate"),O("transferFeeExtensionAuth"),j(G(),184)]);import Ie from"bn.js";import mn from"bn.js";var Je=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var dn=class extends Je{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new q(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new q(t.toString()).div(e.toString()).mul(10**(i-r))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new q(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new q(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new q(e.virtualB.add(e.realB.add(o)).toString()).div(e.virtualA.sub(e.realA.add(r)).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){if(e.lte(i))throw Error("supply need gt total sell");let s=e.sub(i).sub(r);if(s.lte(new mn(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(o);if(a.lte(new mn(0)))throw Error("tfMinusMf <= 0");let c=a.mul(i).mul(i).div(s),u=a.mul(i).div(s).sub(t),l=c.div(u),m=t.mul(t).div(u);if(l.lt(new mn(0))||m.lt(new mn(0)))throw Error("invalid input 0");return{a:l,b:m,c:i}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:i}){let r=e.mul(i),o=t.add(e);return r.div(o)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:i}){let r=t.mul(e),o=i.sub(e);return it(r,o)}};import pn from"bn.js";var fn=class extends Je{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new q(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new q(t.toString()).div(e.toString()).mul(10**(i-r))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new q(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new q(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new q(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(r).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){let s=e.sub(r);if(s.lte(new pn(0)))throw Error("invalid input 1");let a=new pn(2).mul(t).sub(o),u=t.mul(s).div(a);if(u.lt(new pn(0))||t.lt(new pn(0)))throw Error("invalid input 0");return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:i}){return i.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:i}){let r=t.mul(e);return it(r,i)}};import Ae from"bn.js";import Or from"bn.js";var qt=class{static _multipler(e){return new q(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:i}){return new q(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(i))}static getPriceX64({price:e,decimalA:t,decimalB:i}){let r=e.mul(this._multipler(i)).div(this._multipler(t));return new Or(r.mul(this._Q64).toFixed(0))}};qt._Q64=new q(new Or(1).shln(64).toString());var bn=class extends Je{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new q(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new q(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new q(e.virtualA.mul(e.realA).toString()).div(qt._Q64).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new q(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new q(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(r).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){let s=e.sub(r);if(s.lte(new Ae(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new Ae(3)).sub(o),u=t.mul(new Ae(2)).mul(s).div(a),l=u.mul(u),m=t.mul(new Ae(2)).mul(De).div(l);if(!m.gt(new Ae(0)))throw Error("a need gt 0");if(!Jn.gt(m))throw Error("a need lt u64 max");if(m.lt(new Ae(0))||u.lt(new Ae(0)))throw Error("invalid input 0");return{a:m,b:new Ae(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let i=e.realB.add(t),r=new Ae(2).mul(i).mul(De).div(e.virtualA);return new Ae(new q(r.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let i=e.realA.add(t),r=i.mul(i);return it(e.virtualA.mul(r),new Ae(2).mul(De)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let i=e.realA.sub(t),r=i.mul(i),o=it(e.virtualA.mul(r),new Ae(2).mul(De));return e.realB.sub(o)}static sellExactOut({poolInfo:e,amount:t}){let i=e.realB.sub(t),r=new Ae(2).mul(i).mul(De).div(e.virtualA),o=new Ae(new q(r.toString()).sqrt().toFixed(0));return e.realA.sub(o)}};var Se=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:i}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:i.supply,totalFundRaising:i.totalFundRaisingB,totalSell:i.totalSellA,totalLockedAmount:i.vestingSchedule.totalLockedAmount,migrateFee:i.migrateFee,decimalA:i.mintDecimalsA,decimalB:i.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:i,totalFundRaising:r,totalSell:o,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let l=this.getCurve(e),m=l.getInitParam({supply:i,totalFundRaising:r,totalSell:o,totalLockedAmount:s,migrateFee:a}),d=l.getPoolInitPriceByInit(Q(z({},m),{decimalA:c,decimalB:u})),p=r.div(new Ie(t-1)),f=new Ie(0),b=[{price:d,totalSellSupply:0}],{a:y,b:A}=m,k=f,h=f;for(let B=1;B<t;B++){let P=B!==t-1?p:r.sub(h),w=this.buyExactIn({poolInfo:{virtualA:y,virtualB:A,realA:k,realB:h,totalFundRaisingB:r,totalSellA:o},amountB:P,protocolFeeRate:f,platformFeeRate:f,curveType:e,shareFeeRate:f,creatorFeeRate:f,transferFeeConfigA:void 0,slot:0});k=k.add(w.amountA.amount),h=h.add(w.amountB);let K=this.getPrice({poolInfo:{virtualA:y,virtualB:A,realA:k,realB:h},decimalA:c,decimalB:u,curveType:e});b.push({price:K,totalSellSupply:new q(k.toString()).div(10**c).toNumber()})}return b}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i,curveType:r}){return this.getCurve(r).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i})}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r,curveType:o}){return this.getCurve(o).getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r})}static getPrice({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:i,decimalB:r})}static getEndPrice({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:i,decimalB:r})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:i,decimalB:r})}static checkParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,decimals:o,config:s,migrateType:a}){if(Number(o)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(rt).lt(r))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new Ie(10**o))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div(rt);if(i.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let l=e.sub(i).sub(r),m=e.mul(s.minMigrateRateA).div(rt);if(l.lt(m))throw Error("migrate lt min migrate amoount");let d=e.sub(i).sub(r),p=new Ie(new q(d.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let f=new Ie(10).pow(new Ie(o));if(p.lte(f))throw Error("check migrate lp error")}else if(a==="cpmm"){let f=new Ie(100);if(p.lte(f))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let l=this.totalFeeRate({protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a}),m=this.calculateFee({amount:t,feeRate:l}),d=t.sub(m),p=this.getCurve(o),f=p.buyExactIn({poolInfo:e,amount:d}),b=e.totalSellA.sub(e.realA),y,A,k;if(f.gt(b)){y=b;let B=p.buyExactOut({poolInfo:e,amount:y});A=this.calculatePreFee({postFeeAmount:B,feeRate:l}),k=A.sub(B)}else y=f,A=t,k=m;let h=this.splitFee({totalFee:k,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a});return{amountA:Wn(y,c,u),amountB:A,splitFee:h}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let l=e.totalSellA.sub(e.realA),m=Vn(t,c,u),d=m.fee?m.amount.add(m.fee):m.amount;t.gt(l)&&(d=l);let f=this.getCurve(o).buyExactOut({poolInfo:e,amount:d}),b=this.totalFeeRate({protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a}),y=this.calculatePreFee({postFeeAmount:f,feeRate:b}),A=y.sub(f),k=this.splitFee({totalFee:A,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:y,splitFee:k}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let l=this.getCurve(o),m=Wn(t,c,u),d=m.fee?m.amount.sub(m.fee):m.amount,p=l.sellExactIn({poolInfo:e,amount:d}),f=this.calculateFee({amount:p,feeRate:this.totalFeeRate({protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a})}),b=this.splitFee({totalFee:f,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:p.sub(f),splitFee:b}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let l=this.totalFeeRate({protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a}),m=this.calculatePreFee({postFeeAmount:t,feeRate:l});if(e.realB.lt(m))throw Error("Insufficient liquidity");let d=m.sub(t),f=Se.getCurve(o).sellExactOut({poolInfo:e,amount:m});if(f.gt(e.realA))throw Error();let b=this.splitFee({totalFee:d,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a});return{amountA:Vn(f,c,u),amountB:t,splitFee:b}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:i,shareFeeRate:r,creatorFeeRate:o}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:i,shareFeeRate:r,creatorFeeRate:o}),a=s.isZero()?new Ie(0):e.mul(i).div(s),c=s.isZero()?new Ie(0):e.mul(r).div(s),u=s.isZero()?new Ie(0):e.mul(o).div(s),l=e.sub(a).sub(c).sub(u);return{platformFee:a,shareFee:c,protocolFee:l,creatorFee:u}}static calculateFee({amount:e,feeRate:t}){return Zi(e,t,rt)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let i=e.mul(rt),r=rt.sub(t);return i.add(r).sub(new Ie(1)).div(r)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:i,creatorFeeRate:r}){if(e.add(t).add(i).add(r).gt(new Ie(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(i).add(r)}static getCurve(e){switch(e){case 0:return dn;case 1:return fn;case 2:return bn}throw Error("find curve error")}};var ut={initPriceX64:new V("515752397214619"),supply:new V(1e15),totalSellA:new V(7931e11),totalFundRaisingB:new V(85e9),totalLockedAmount:new V("0"),cliffPeriod:new V("0"),unlockPeriod:new V("0"),decimals:6,virtualA:new V("1073471847374405"),virtualB:new V("30050573465"),realA:new V(0),realB:new V(0),protocolFee:new V(0),platformId:new Dr("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new V(0),cliffPeriod:new V(0),unlockPeriod:new V(0),startTime:new V(0),totalAllocatedShare:new V(0)}},$e=new V(1e4),pi=class extends yt{constructor(e){super(e)}async createLaunchpad(L){var _=L,{programId:e=de,authProgramId:t,platformId:i=ut.platformId,mintA:r,decimals:o=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:l,configId:m,configInfo:d,platformFeeRate:p,txVersion:f,computeBudgetConfig:b,txTipConfig:y,feePayer:A,buyAmount:k,minMintAAmount:h,slippage:B,associatedOnly:P=!0,checkCreateATAOwner:w=!1,extraSigners:K,token2022:x,transferFeeExtensionParams:C}=_,I=et(_,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","configInfo","platformFeeRate","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners","token2022","transferFeeExtensionParams"]);var fi,bi,yi,gi,Pi,wi,Ai,ki,Ti,hi;let D=this.createTxBuilder(A);t=t!=null?t:We(e).publicKey,x=!!C,x&&(l="cpmm");let R=d;if(!R&&m){let Me=await this.scope.connection.getAccountInfo(m);Me&&(R=Ye.decode(Me.data))}R||this.logAndCreateError("config not found");let S=R.mintB,N=R.curveType,{publicKey:J}=kt(e,r,S),{publicKey:te}=oi(e,J,r),{publicKey:Y}=oi(e,J,S),{publicKey:ue}=ti(r);this.logDebug(`create token: ${r.toBase58()}, mintB: ${S.toBase58()}, decimals A:${o}/B:${s}, config:${m.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty");let se=(fi=I==null?void 0:I.supply)!=null?fi:ut.supply,re=(bi=I==null?void 0:I.totalSellA)!=null?bi:ut.totalSellA,ae=(yi=I==null?void 0:I.totalFundRaisingB)!=null?yi:ut.totalFundRaisingB,Z=(gi=I==null?void 0:I.totalLockedAmount)!=null?gi:new V(0),H=p;if(!p){let Me=await this.scope.connection.getAccountInfo(i);Me||this.logAndCreateError("platform id not found:",i.toString()),H=ht.decode(Me.data).feeRate}let le=Se.getCurve(R.curveType).getInitParam({supply:se,totalFundRaising:ae,totalSell:re,totalLockedAmount:Z,migrateFee:R.migrateFee}),ke={epoch:new V(896),bump:254,status:0,mintDecimalsA:o,mintDecimalsB:s,supply:se,totalSellA:re,mintA:new Dr(r),mintB:S,virtualA:le.a,virtualB:le.b,realA:ut.realA,realB:ut.realB,migrateFee:R.migrateFee,migrateType:l==="amm"?0:1,protocolFee:ut.protocolFee,platformFee:H,platformId:i,configId:m,vaultA:te,vaultB:Y,creator:this.scope.ownerPubKey,totalFundRaisingB:ae,vestingSchedule:{totalLockedAmount:Z,cliffPeriod:new V(0),unlockPeriod:new V(0),startTime:new V(0),totalAllocatedShare:new V(0)},mintProgramFlag:x?1:0},Wr=Se.getCurve(R.curveType),{c:Vr}=Wr.getInitParam({supply:ke.supply,totalFundRaising:ke.totalFundRaisingB,totalLockedAmount:Z,totalSell:R.curveType===0?ke.totalSellA:new V(0),migrateFee:R.migrateFee});try{Se.checkParam({supply:ke.supply,totalFundRaising:ke.totalFundRaisingB,totalSell:Vr,totalLockedAmount:Z,decimals:ke.mintDecimalsA,config:R,migrateType:l}),this.logDebug("check init params success")}catch(Me){this.logAndCreateError(`check create mint params failed, ${Me.message}`)}D.addInstruction({instructions:[x?Cr(e,A!=null?A:this.scope.ownerPubKey,this.scope.ownerPubKey,m,i,t,J,r,S,te,Y,o,a,c,u||"https://",{type:N===0?"ConstantCurve":N===1?"FixedCurve":N===2?"LinearCurve":"ConstantCurve",totalSellA:re,migrateType:l,supply:se,totalFundRaisingB:ae},Z,(Pi=I==null?void 0:I.cliffPeriod)!=null?Pi:new V(0),(wi=I==null?void 0:I.unlockPeriod)!=null?wi:new V(0),C):Kr(e,A!=null?A:this.scope.ownerPubKey,this.scope.ownerPubKey,m,i,t,J,r,S,te,Y,ue,o,a,c,u||"https://",{type:N===0?"ConstantCurve":N===1?"FixedCurve":N===2?"LinearCurve":"ConstantCurve",totalSellA:re,migrateType:l,supply:se,totalFundRaisingB:ae},Z,(Ai=I==null?void 0:I.cliffPeriod)!=null?Ai:new V(0),(ki=I==null?void 0:I.unlockPeriod)!=null?ki:new V(0))]});let Pn=x?await this.scope.connection.getEpochInfo():void 0,Gt=C?{epoch:BigInt((Pn==null?void 0:Pn.epoch)||0),maximumFee:BigInt((Ti=C==null?void 0:C.maxinumFee.toString())!=null?Ti:0),transferFeeBasisPoints:(hi=C==null?void 0:C.transferFeeBasePoints)!=null?hi:0}:void 0,wn={amountA:{amount:new V(0),fee:void 0,expirationTime:void 0},amountB:new V(0),splitFee:{platformFee:new V(0),shareFee:new V(0),protocolFee:new V(0),creatorFee:new V(0)}},An;if(K!=null&&K.length&&D.addInstruction({signers:K}),!I.createOnly){let{builder:Me,extInfo:_r}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:x?at:void 0,mintA:r,mintB:S,poolInfo:ke,buyAmount:k,minMintAAmount:h,shareFeeRate:I.shareFeeRate,shareFeeReceiver:I.shareFeeReceiver,configInfo:R,platformFeeRate:H,slippage:B,associatedOnly:P,checkCreateATAOwner:w,skipCheckMintA:!Gt,transferFeeConfigA:Gt?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:Gt,newerTransferFee:Gt}:void 0});D.addInstruction(z({},Me.AllTxData)),wn=z({},_r),An=(this.scope.cluster==="devnet"||f===1)&&I.shareFeeReceiver?[Me.allInstructions[0]]:void 0}return D.addTipInstruction(y),f===0?D.sizeCheckBuildV0({computeBudgetConfig:b,swapInfo:wn,splitIns:An,address:Q(z({},ke),{poolId:J})}):D.sizeCheckBuild({computeBudgetConfig:b,swapInfo:wn,splitIns:An,address:Q(z({},ke),{poolId:J})})}async buyToken({programId:e=de,authProgramId:t,mintA:i,mintAProgram:r=oe,mintB:o=Ue,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d,buyAmount:p,minMintAAmount:f,slippage:b,shareFeeRate:y=new V(0),shareFeeReceiver:A,associatedOnly:k=!0,checkCreateATAOwner:h=!1,transferFeeConfigA:B,skipCheckMintA:P=!1}){var Z,H,Ce;p.lte(new V(0))&&this.logAndCreateError("buy amount should gt 0:",p.toString());let w=this.createTxBuilder(d),{publicKey:K}=kt(e,i,o);t=t!=null?t:We(e).publicKey;let x=B;if(!P)if(x)r=at;else{let le=await this.scope.connection.getAccountInfo(i);if(le&&le.owner.equals(at)){r=le.owner;let ke=gn(i,le,r);x=yn(ke)||void 0}}let C=this.scope.account.getAssociatedTokenAccount(i,r),I=null,L=o.equals(Ue);w.addInstruction({instructions:[Ke(this.scope.ownerPubKey,C,this.scope.ownerPubKey,i,r)]});let{account:_,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:L?{payer:this.scope.ownerPubKey,amount:p}:void 0,skipCloseAccount:!L,notUseTokenAccount:L,associatedOnly:L?!1:k,checkCreateATAOwner:h});_&&(I=_),w.addInstruction(D||{}),I===void 0&&this.logAndCreateError(`cannot found mintB(${o.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let R=s;if(!R){let le=await this.scope.connection.getAccountInfo(K,{commitment:"processed"});le||this.logAndCreateError("cannot found pool:",K.toBase58()),R=Fe.decode(le.data)}let S=a,N=await _e(this.scope.connection,[S?void 0:R.configId,R.platformId].filter(Boolean).map(le=>({pubkey:le})));if(!S){let le=N.find(ke=>ke.pubkey.equals(R.configId));(!le||!le.accountInfo)&&this.logAndCreateError("config not found: ",R.configId.toBase58()),S=Ye.decode(le.accountInfo.data)}let J=N.find(le=>le.pubkey.equals(R.platformId));(!J||!J.accountInfo)&&this.logAndCreateError("platform info not found: ",R.configId.toBase58());let te=ht.decode(J.accountInfo.data);c=c||te.feeRate;let Y=Se.buyExactIn({poolInfo:R,amountB:p,protocolFeeRate:S.tradeFeeRate,platformFeeRate:c,curveType:S.curveType,shareFeeRate:y,creatorFeeRate:te.creatorFeeRate,transferFeeConfigA:x,slot:await this.scope.connection.getSlot()}),ue=new q(Y.amountA.amount.toString()).sub((H=(Z=Y.amountA.fee)==null?void 0:Z.toString())!=null?H:0),se=b?new q($e.sub(b).toNumber()/$e.toNumber()).clampedTo(0,1):new q(1),re=f!=null?f:b?new V(ue.mul(se).toFixed(0)):Y.amountA.amount.sub((Ce=Y.amountA.fee)!=null?Ce:new V(0));Y.amountB.lt(p)&&console.log(`maximum ${i.toBase58()} amount can buy is ${Y.amountA.toString()}, input ${o.toBase58()} amount: ${Y.amountB.toString()}`);let ae=A?Le(A,o,oe).publicKey:void 0;return ae&&w.addInstruction({instructions:[Ke(this.scope.ownerPubKey,ae,A,o)]}),w.addInstruction({instructions:[Nr(e,this.scope.ownerPubKey,t,R.configId,R.platformId,K,C,I,R.vaultA,R.vaultB,i,o,r,oe,st(e,R.platformId,o).publicKey,Tt(e,R.creator,o).publicKey,Y.amountB.lt(p)?Y.amountB:p,re,y,ae)]}),w.addCustomComputeBudget(l),w.addTipInstruction(m),w.versionBuild({txVersion:u,extInfo:Q(z({},Y),{decimalOutAmount:ue,minDecimalOutAmount:new q(re.toString())})})}async buyTokenExactOut({programId:e=de,authProgramId:t,mintA:i,mintAProgram:r=oe,mintB:o=Ue,poolInfo:s,configInfo:a,transferFeeConfigA:c,platformFeeRate:u,txVersion:l,computeBudgetConfig:m,txTipConfig:d,feePayer:p,maxBuyAmount:f,outAmount:b,slippage:y,shareFeeRate:A=new V(0),shareFeeReceiver:k,associatedOnly:h=!0,checkCreateATAOwner:B=!1,skipCheckMintA:P=!1}){b.lte(new V(0))&&this.logAndCreateError("out amount should gt 0:",b.toString());let w=this.createTxBuilder(p),{publicKey:K}=kt(e,i,o);t=t!=null?t:We(e).publicKey;let x=s;if(!x){let Z=await this.scope.connection.getAccountInfo(K,{commitment:"processed"});Z||this.logAndCreateError("cannot found pool:",K.toBase58()),x=Fe.decode(Z.data)}let C=a,I=await _e(this.scope.connection,[C?void 0:x.configId,x.platformId].filter(Boolean).map(Z=>({pubkey:Z})));if(!C){let Z=I.find(H=>H.pubkey.equals(x.configId));(!Z||!Z.accountInfo)&&this.logAndCreateError("config not found: ",x.configId.toBase58()),C=Ye.decode(Z.accountInfo.data)}let L=I.find(Z=>Z.pubkey.equals(x.platformId));(!L||!L.accountInfo)&&this.logAndCreateError("platform info not found: ",x.configId.toBase58());let _=ht.decode(L.accountInfo.data);u=u||_.feeRate;let D=c;if(!P)if(D)r=at;else{let Z=await this.scope.connection.getAccountInfo(i);if(Z&&Z.owner.equals(at)){r=Z.owner;let H=gn(i,Z,r);D=yn(H)||void 0}}let R=Se.buyExactOut({poolInfo:x,amountA:b,protocolFeeRate:C.tradeFeeRate,platformFeeRate:u,curveType:C.curveType,shareFeeRate:A,creatorFeeRate:_.creatorFeeRate,transferFeeConfigA:D,slot:await this.scope.connection.getSlot()}),S=new q(R.amountB.toString()),N=y?new q($e.add(y).toNumber()/$e.toNumber()).clampedTo(0,Number.MIN_SAFE_INTEGER):new q(1),J=(f!=null?f:y)?new V(S.mul(N).toFixed(0)):R.amountB,te=this.scope.account.getAssociatedTokenAccount(i,r),Y=null,ue=o.equals(Ue);w.addInstruction({instructions:[Ke(this.scope.ownerPubKey,te,this.scope.ownerPubKey,i,r)]});let{account:se,instructionParams:re}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:ue?{payer:this.scope.ownerPubKey,amount:R.amountB}:void 0,skipCloseAccount:!ue,notUseTokenAccount:ue,associatedOnly:ue?!1:h,checkCreateATAOwner:B});se&&(Y=se),w.addInstruction(re||{}),Y===void 0&&this.logAndCreateError(`cannot found mintB(${o.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let ae=k?Le(k,o,oe).publicKey:void 0;return ae&&w.addInstruction({instructions:[Ke(this.scope.ownerPubKey,ae,k,o)]}),w.addInstruction({instructions:[Rr(e,this.scope.ownerPubKey,t,x.configId,x.platformId,K,te,Y,x.vaultA,x.vaultB,i,o,r,oe,st(e,x.platformId,o).publicKey,Tt(e,x.creator,o).publicKey,b,J,A,ae)]}),w.addCustomComputeBudget(m),w.addTipInstruction(d),w.versionBuild({txVersion:l,extInfo:{maxSpentAmount:J,outAmount:b}})}async sellToken({programId:e=de,authProgramId:t,mintAProgram:i=oe,mintA:r,mintB:o=Ue,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d,sellAmount:p,minAmountB:f,slippage:b,shareFeeRate:y=new V(0),shareFeeReceiver:A,associatedOnly:k=!0,checkCreateATAOwner:h=!1,skipCheckMintA:B=!1}){t=t!=null?t:We(e).publicKey;let P=this.createTxBuilder(d);p.lte(new V(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:w}=kt(e,r,o),K;if(!B){let H=await this.scope.connection.getAccountInfo(r);if(H&&H.owner.equals(at)){i=H.owner;let Ce=gn(r,H,i);K=yn(Ce)||void 0}}let x=null,C=null,I=o.equals(Ue),{account:L,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:i,mint:r,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:k,checkCreateATAOwner:h});L&&(x=L),P.addInstruction(_||{}),x===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:D,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:I?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!I,notUseTokenAccount:I,associatedOnly:I?!1:k,checkCreateATAOwner:h});D&&(C=D),P.addInstruction(R||{}),C===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let H=await this.scope.connection.getAccountInfo(w,{commitment:"processed"});H||this.logAndCreateError("cannot found pool",w.toBase58()),S=Fe.decode(H.data)}let N=a,J=await _e(this.scope.connection,[N?void 0:S.configId,S.platformId].filter(Boolean).map(H=>({pubkey:H})));if(!N){let H=J.find(Ce=>Ce.pubkey.equals(S.configId));(!H||!H.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),N=Ye.decode(H.accountInfo.data)}let te=J.find(H=>H.pubkey.equals(S.platformId));(!te||!te.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let Y=ht.decode(te.accountInfo.data);c=c||Y.feeRate;let ue=Se.sellExactIn({poolInfo:S,amountA:p,protocolFeeRate:N.tradeFeeRate,platformFeeRate:c,curveType:N.curveType,shareFeeRate:y,creatorFeeRate:Y.creatorFeeRate,transferFeeConfigA:K,slot:await this.scope.connection.getSlot()}),se=new q(ue.amountB.toString()),re=b?new q($e.sub(b).toNumber()/$e.toNumber()).clampedTo(0,1):new q(1),ae=f!=null?f:b?new V(se.mul(re).toFixed(0)):ue.amountB;ae.lte(new V(0))&&this.logAndCreateError(`out ${o.toBase58()} amount should be gt 0`);let Z=A?Le(A,o,oe).publicKey:void 0;return Z&&P.addInstruction({instructions:[Ke(this.scope.ownerPubKey,Z,A,o)]}),P.addInstruction({instructions:[Lr(e,this.scope.ownerPubKey,t,S.configId,S.platformId,w,x,C,S.vaultA,S.vaultB,r,o,i,oe,st(e,S.platformId,o).publicKey,Tt(e,S.creator,o).publicKey,ue.amountA.amount.lt(p)?ue.amountA.amount:p,ae,y,Z)]}),P.addCustomComputeBudget(l),P.addTipInstruction(m),P.versionBuild({txVersion:u,extInfo:{outAmount:ae}})}async sellTokenExactOut({programId:e=de,authProgramId:t,mintAProgram:i=oe,mintA:r,mintB:o=Ue,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d,inAmount:p,maxSellAmount:f,slippage:b,shareFeeRate:y=new V(0),shareFeeReceiver:A,associatedOnly:k=!0,checkCreateATAOwner:h=!1,skipCheckMintA:B=!1}){t=t!=null?t:We(e).publicKey;let P=this.createTxBuilder(d);f!=null&&f.lte(new V(0))&&this.logAndCreateError("max sell amount should be gt 0");let{publicKey:w}=kt(e,r,o),K;if(!B){let H=await this.scope.connection.getAccountInfo(r);if(H&&H.owner.equals(at)){i=H.owner;let Ce=gn(r,H,i);K=yn(Ce)||void 0}}let x=null,C=null,I=o.equals(Ue),{account:L,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:i,mint:r,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:k,checkCreateATAOwner:h});L&&(x=L),P.addInstruction(_||{}),x===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:D,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:I?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!I,notUseTokenAccount:I,associatedOnly:I?!1:k,checkCreateATAOwner:h});D&&(C=D),P.addInstruction(R||{}),C===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let S=s;if(!S){let H=await this.scope.connection.getAccountInfo(w,{commitment:"processed"});H||this.logAndCreateError("cannot found pool",w.toBase58()),S=Fe.decode(H.data)}let N=a,J=await _e(this.scope.connection,[N?void 0:S.configId,S.platformId].filter(Boolean).map(H=>({pubkey:H})));if(!N){let H=J.find(Ce=>Ce.pubkey.equals(S.configId));(!H||!H.accountInfo)&&this.logAndCreateError("config not found: ",S.configId.toBase58()),N=Ye.decode(H.accountInfo.data)}let te=J.find(H=>H.pubkey.equals(S.platformId));(!te||!te.accountInfo)&&this.logAndCreateError("platform info not found: ",S.configId.toBase58());let Y=ht.decode(te.accountInfo.data);c=c||Y.feeRate;let ue=Se.sellExactOut({poolInfo:S,amountB:p,protocolFeeRate:N.tradeFeeRate,platformFeeRate:c,curveType:N.curveType,shareFeeRate:y,creatorFeeRate:Y.creatorFeeRate,transferFeeConfigA:K,slot:await this.scope.connection.getSlot()}),se=new q(ue.amountA.amount.toString()),re=b?new q($e.add(b).toNumber()/$e.toNumber()).clampedTo(0,Number.MAX_SAFE_INTEGER):new q(1),ae=(f!=null?f:b)?new V(se.mul(re).toFixed(0)):ue.amountA.amount,Z=A?Le(A,o,oe).publicKey:void 0;return Z&&P.addInstruction({instructions:[Ke(this.scope.ownerPubKey,Z,A,o)]}),P.addInstruction({instructions:[Fr(e,this.scope.ownerPubKey,t,S.configId,S.platformId,w,x,C,S.vaultA,S.vaultB,r,o,i,oe,st(e,S.platformId,o).publicKey,Tt(e,S.creator,o).publicKey,p,ae,y,Z)]}),P.addCustomComputeBudget(l),P.addTipInstruction(m),P.versionBuild({txVersion:u,extInfo:{maxSellAmount:ae}})}async createPlatformConfig({programId:e=de,platformAdmin:t,platformClaimFeeWallet:i,platformLockNftWallet:r,cpConfigId:o,migrateCpLockNftScale:s,transferFeeExtensionAuth:a,creatorFeeRate:c,feeRate:u,name:l,web:m,img:d,txVersion:p,computeBudgetConfig:f,txTipConfig:b,feePayer:y}){let A=this.createTxBuilder(y),{publicKey:k}=si(e,t);return A.addInstruction({instructions:[Mr(e,t,i,r,k,o,a,s,u,c,l,m,d)]}),A.addCustomComputeBudget(f),A.addTipInstruction(b),A.versionBuild({txVersion:p,extInfo:{platformId:k}})}async updatePlatformConfig({programId:e=de,platformAdmin:t,platformId:i,updateInfo:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=i!=null?i:si(e,t).publicKey;return u.addInstruction({instructions:[vr(e,t,l,r)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimPlatformFee({programId:e=de,authProgramId:t,platformId:i,poolId:r,platformClaimFeeWallet:o,mintB:s,vaultB:a,mintBProgram:c=oe,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d}){var A;let p=this.createTxBuilder(d);t=t!=null?t:We(e).publicKey;let f=s,b=a;if(!f){let k=await this.scope.connection.getAccountInfo(r,{commitment:"processed"});k||this.logAndCreateError("cannot found pool:",r.toBase58());let h=Fe.decode(k.data),B=await this.scope.connection.getAccountInfo(h.configId,{commitment:"processed"});B||this.logAndCreateError("cannot found config:",h.configId.toBase58()),f=Ye.decode(B.data).mintB,b=b!=null?b:h.vaultB}(!f||!b)&&this.logAndCreateError("cannot found mint info, mintB: ",f.toBase58(),", vaultB: ",(A=b==null?void 0:b.toBase58())!=null?A:"");let y=Le(this.scope.ownerPubKey,f,oe).publicKey;return p.addInstruction({instructions:[Ke(this.scope.ownerPubKey,y,this.scope.ownerPubKey,f)]}),p.addInstruction({instructions:[mi(e,o,t,r,i,b,y,f,c)]}),p.addCustomComputeBudget(l),p.addTipInstruction(m),p.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=de,authProgramId:t,platformId:i,platformClaimFeeWallet:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t!=null?t:We(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:Fe.span},{memcmp:{offset:Fe.offsetOf("platformId"),bytes:i.toString()}}]})).forEach(m=>{let d=Fe.decode(m.account.data);if(d.platformFee.lte(new V(0)))return;let p=Le(this.scope.ownerPubKey,d.mintB,oe).publicKey;u.addInstruction({instructions:[Ke(this.scope.ownerPubKey,p,this.scope.ownerPubKey,d.mintB)]}),u.addInstruction({instructions:[mi(e,r,t,m.pubkey,i,d.vaultB,p,d.mintB,oe)]})}),u.addTipInstruction(a),o===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=de,poolId:t,beneficiary:i,shareAmount:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=await this.getRpcPoolInfo({poolId:t});r.add(l.vestingSchedule.totalAllocatedShare).gt(l.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount");let m=Vt(e,t,i).publicKey;return u.addInstruction({instructions:[li(e,this.scope.ownerPubKey,i,t,m,r)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async createMultipleVesting({programId:e=de,poolId:t,beneficiaryList:i,txVersion:r,computeBudgetConfig:o,feePayer:s}){let a=this.createTxBuilder(s);i.length===0&&this.logAndCreateError("beneficiaryList is null");let c=await this.getRpcPoolInfo({poolId:t});return i.reduce((l,m)=>l.add(m.shareAmount),c.vestingSchedule.totalAllocatedShare).gt(c.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount"),i.forEach(l=>{let m=Vt(e,t,l.wallet).publicKey;a.addInstruction({instructions:[li(e,this.scope.ownerPubKey,l.wallet,t,m,l.shareAmount)]})}),r===0?a.sizeCheckBuildV0({computeBudgetConfig:o}):a.sizeCheckBuild({computeBudgetConfig:o})}async claimVesting({programId:e=de,poolId:t,poolInfo:i,vestingRecord:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=We(e).publicKey,m=r||Vt(e,t,this.scope.ownerPubKey).publicKey,d=i;if(!d){let f=await this.scope.connection.getAccountInfo(t);f||this.logAndCreateError("pool not found"),d=Fe.decode(f.data)}let p=Le(this.scope.ownerPubKey,d.mintA,oe).publicKey;return u.addInstruction({instructions:[Ke(this.scope.ownerPubKey,p,this.scope.ownerPubKey,d.mintA)]}),u.addInstruction({instructions:[ci(e,this.scope.ownerPubKey,l,t,m,p,d.vaultA,d.mintA,oe)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimMultiVesting({programId:e=de,poolIdList:t,poolsInfo:i={},vestingRecords:r={},txVersion:o,computeBudgetConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=z({},i),l=We(e).publicKey,m=t.filter(d=>!u[d.toBase58()]);if(m.length){let d=await this.getRpcPoolsInfo({poolIdList:m});u=z(z({},u),d.poolInfoMap)}return t.forEach(d=>{let p=d.toBase58(),f=u[p];f||this.logAndCreateError(`pool info not found: ${p}`);let b=r[p]||Vt(e,d,this.scope.ownerPubKey).publicKey,y=Le(this.scope.ownerPubKey,f.mintA,oe).publicKey;c.addInstruction({instructions:[Ke(this.scope.ownerPubKey,y,this.scope.ownerPubKey,f.mintA)]}),c.addInstruction({instructions:[ci(e,this.scope.ownerPubKey,l,d,b,y,f.vaultA,f.mintA,oe)]})}),o===0?c.sizeCheckBuildV0({computeBudgetConfig:s}):c.sizeCheckBuild({computeBudgetConfig:s})}async claimVaultPlatformFee({programId:e=de,platformId:t,mintB:i,mintBProgram:r=oe,claimFeeWallet:o,txVersion:s,computeBudgetConfig:a,txTipConfig:c,feePayer:u}){let l=this.createTxBuilder(u),m=st(e,t,i).publicKey,d=ai(e).publicKey,p=this.scope.account.getAssociatedTokenAccount(i,r);return l.addInstruction({instructions:[Ke(this.scope.ownerPubKey,p,this.scope.ownerPubKey,i,r),di(e,t,o!=null?o:this.scope.ownerPubKey,d,m,p,i,r)]}),l.addCustomComputeBudget(a),l.addTipInstruction(c),l.versionBuild({txVersion:s})}async claimMultipleVaultPlatformFee({programId:e=de,platformList:t,unwrapSol:i=!0,txVersion:r,computeBudgetConfig:o,feePayer:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1}){let u=this.createTxBuilder(s),l={};return t.forEach(async m=>{var y,A;let d=ai(e).publicKey,p=st(e,m.id,m.mintB).publicKey,f=m.mintB.equals(Ue)&&i,b=l[m.mintB.toBase58()];if(!b){let{account:k,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintB,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!f,notUseTokenAccount:f,associatedOnly:f?!1:a,checkCreateATAOwner:c});k&&(b=k),u.addInstruction(h||{}),b===void 0&&this.logAndCreateError(`cannot found platform ${m.id.toBase58()} mintB(${m.mintB.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts)}u.addInstruction({instructions:[di(e,m.id,(y=m.claimFeeWallet)!=null?y:this.scope.ownerPubKey,p,d,b,m.mintB,(A=m.mintBProgram)!=null?A:oe)]})}),r===0?u.sizeCheckBuildV0({computeBudgetConfig:o}):u.sizeCheckBuild({computeBudgetConfig:o})}async claimCreatorFee({programId:e=de,mintB:t,mintBProgram:i=oe,txVersion:r,computeBudgetConfig:o,txTipConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=Tt(e,this.scope.ownerPubKey,t).publicKey,l=Sr(e).publicKey,m=this.scope.account.getAssociatedTokenAccount(t,i);return c.addInstruction({instructions:[Ke(this.scope.ownerPubKey,m,this.scope.ownerPubKey,t,i),Er(e,this.scope.ownerPubKey,l,u,m,t,i)]}),c.addCustomComputeBudget(o),c.addTipInstruction(s),c.versionBuild({txVersion:r})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let i=await _e(this.scope.connection,e.map(c=>({pubkey:c})),t),r={},o=[];for(let c=0;c<e.length;c++){let u=i[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let l=Fe.decode(u.accountInfo.data);r[e[c].toBase58()]=Q(z({},l),{poolId:u.accountInfo.owner}),o.push(l.configId)}let s=await _e(this.scope.connection,o.map(c=>({pubkey:c})),t),a={};for(let c=0;c<o.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+o[c].toBase58());let l=Ye.decode(u.accountInfo.data);a[o[c].toBase58()]=Q(z({},l),{configId:u.accountInfo.owner})}return{poolInfoMap:Object.keys(r).reduce((c,u)=>Q(z({},c),{[u]:Q(z({},r[u]),{configInfo:a[r[u].configId.toBase58()]})}),{})}}};export{ut as LaunchpadPoolInitParam,pi as default};
//# sourceMappingURL=launchpad.mjs.map