var In=Object.defineProperty,Bn=Object.defineProperties;var Cn=Object.getOwnPropertyDescriptors;var Ke=Object.getOwnPropertySymbols;var Kt=Object.prototype.hasOwnProperty,Vt=Object.prototype.propertyIsEnumerable;var Ft=(e,t,n)=>t in e?In(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,G=(e,t)=>{for(var n in t||(t={}))Kt.call(t,n)&&Ft(e,n,t[n]);if(Ke)for(var n of Ke(t))Vt.call(t,n)&&Ft(e,n,t[n]);return e},J=(e,t)=>Bn(e,Cn(t));var Ve=(e,t)=>{var n={};for(var r in e)Kt.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Ke)for(var r of Ke(e))t.indexOf(r)<0&&Vt.call(e,r)&&(n[r]=e[r]);return n};import{PublicKey as Oe}from"@solana/web3.js";import Sn from"bn.js";import{PublicKey as k}from"@solana/web3.js";var ui=new k("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ci=new k("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),li=new k("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),fi=new k("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),mi=new k("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),pi=new k("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),di=new k("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),gi=new k("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),hi=new k("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),bi=new k("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),yi=new k("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),wi=new k("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ti=new k("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Pi=new k("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),xi=new k("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Ai=new k("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Ln=new k("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Nn=new k("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Rn=new k("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Mn=new k("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Si=new k("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ki=new k("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Ii=new k("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Bi=new k("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ci=new k("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Li=new k("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Ni=new k("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Ri=new k("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),Mi=new k("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),Di=new k("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),Ei=new k("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX"),Ae={IDO_PROGRAM_ID_V1:Ln,IDO_PROGRAM_ID_V2:Nn,IDO_PROGRAM_ID_V3:Rn,IDO_PROGRAM_ID_V4:Mn};var vi={OPEN_BOOK_PROGRAM:new k("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new k("Ray1111111111111111111111111111111111111111"),AMM_V4:new k("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new k("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new k("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new k("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new k("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new k("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new k("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new k("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new k("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new k("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:k.default,Router:new k("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new k("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new k("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new k("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new k("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new k("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new k("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new k("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new k("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new k("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new k("Ray1111111111111111111111111111111111111111")};import{PublicKey as U,SystemProgram as Wt,SYSVAR_RENT_PUBKEY as Dn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as En}from"@solana/spl-token";function at({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var Vi=[at({pubkey:En,isWritable:!1}),at({pubkey:Wt.programId,isWritable:!1}),at({pubkey:Dn,isWritable:!1})];function Ut({publicKey:e,transformSol:t}){let n=ut(e.toString());if(n instanceof U)return t&&n.equals(Se)?ge:n;if(t&&n.toString()===Se.toBase58())return ge;if(typeof n=="string"){if(n===U.default.toBase58())return U.default;try{return new U(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ut(e){try{return new U(e)}catch{return e}}var Wi=new U("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ui=new U("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),qt=new U("SysvarRent111111111111111111111111111111111"),ct=new U("SysvarC1ock11111111111111111111111111111111"),qi=new U("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Gi=new U("Sysvar1nstructions1111111111111111111111111"),Gt=Wt.programId,ji=new U("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Hi=new U("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Zi=new U("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),zi=new U("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Xi=new U("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ji=new U("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Qi=new U("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Yi=new U("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),$i=new U("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),eo=new U("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),to=new U("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ge=new U("So11111111111111111111111111111111111111112"),Se=U.default;import{PublicKey as $r}from"@solana/web3.js";import ei from"bn.js";import Jr from"big.js";import rt from"bn.js";import ie from"bn.js";var he=9e15,ue=1e9,lt="0123456789abcdef",Ue="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",qe="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",ft={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-he,maxE:he,crypto:!1},zt,te,C=!0,je="[DecimalError] ",ae=je+"Invalid argument: ",Xt=je+"Precision limit exceeded",Jt=je+"crypto unavailable",Qt="[object Decimal]",H=Math.floor,q=Math.pow,vn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,_n=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,On=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Yt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Y=1e7,I=7,Fn=9007199254740991,Kn=Ue.length-1,mt=qe.length-1,p={toStringTag:Qt};p.absoluteValue=p.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),S(e)};p.ceil=function(){return S(new this.constructor(this),this.e+1,2)};p.clampedTo=p.clamp=function(e,t){var n,r=this,i=r.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(ae+t);return n=r.cmp(e),n<0?e:r.cmp(t)>0?t:new i(r)};p.comparedTo=p.cmp=function(e){var t,n,r,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,c=o.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==e.e)return o.e>e.e^c<0?1:-1;for(r=s.length,i=a.length,t=0,n=r<i?r:i;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return r===i?0:r>i^c<0?1:-1};p.cosine=p.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+I,r.rounding=1,n=Vn(r,rn(r,n)),r.precision=e,r.rounding=t,S(te==2||te==3?n.neg():n,e,t,!0)):new r(1):new r(NaN)};p.cubeRoot=p.cbrt=function(){var e,t,n,r,i,o,s,a,c,u,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(C=!1,o=l.s*q(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=j(l.d),e=l.e,(o=(e-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=q(n,1/3),e=H((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?n="5e"+e:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r=new f(n),r.s=l.s):r=new f(o.toString()),s=(e=f.precision)+3;;)if(a=r,c=a.times(a).times(a),u=c.plus(l),r=V(u.plus(l).times(a),u.plus(c),s+2,1),j(a.d).slice(0,s)===(n=j(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(S(a,e+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(S(r,e+1,1),t=!r.times(r).times(r).eq(l));break}return C=!0,S(r,e,f.rounding,t)};p.decimalPlaces=p.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-H(this.e/I))*I,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};p.dividedBy=p.div=function(e){return V(this,new this.constructor(e))};p.dividedToIntegerBy=p.divToInt=function(e){var t=this,n=t.constructor;return S(V(t,new n(e),0,1,1),n.precision,n.rounding)};p.equals=p.eq=function(e){return this.cmp(e)===0};p.floor=function(){return S(new this.constructor(this),this.e+1,3)};p.greaterThan=p.gt=function(e){return this.cmp(e)>0};p.greaterThanOrEqualTo=p.gte=function(e){var t=this.cmp(e);return t==1||t===0};p.hyperbolicCosine=p.cosh=function(){var e,t,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(e=Math.ceil(i/3),t=(1/Ze(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),o=be(s,1,o.times(t),new s(1),!0);for(var c,u=e,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return S(o,s.precision=n,s.rounding=r,!0)};p.hyperbolicSine=p.sinh=function(){var e,t,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,n=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=be(o,2,i,i,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,i=i.times(1/Ze(5,e)),i=be(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=t,o.rounding=n,S(i,t,n,!0)};p.hyperbolicTangent=p.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,V(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)};p.inverseCosine=p.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?t.isNeg()?Q(n,i,o):new n(0):new n(NaN):t.isZero()?Q(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,t=t.asin(),e=Q(n,i+4,o).times(.5),n.precision=i,n.rounding=o,e.minus(t))};p.inverseHyperbolicCosine=p.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,C=!1,n=n.times(n).minus(1).sqrt().plus(n),C=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)};p.inverseHyperbolicSine=p.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,C=!1,n=n.times(n).plus(1).sqrt().plus(n),C=!0,r.precision=e,r.rounding=t,n.ln())};p.inverseHyperbolicTangent=p.atanh=function(){var e,t,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,r=i.sd(),Math.max(r,e)<2*-i.e-1?S(new o(i),e,t,!0):(o.precision=n=r-i.e,i=V(i.plus(1),new o(1).minus(i),n+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5))):new o(NaN)};p.inverseSine=p.asin=function(){var e,t,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),n=o.precision,r=o.rounding,t!==-1?t===0?(e=Q(o,n+4,r).times(.5),e.s=i.s,e):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};p.inverseTangent=p.atan=function(){var e,t,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&f+4<=mt)return s=Q(l,f+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(f+4<=mt)return s=Q(l,f+4,m).times(.5),s.s=u.s,s}for(l.precision=a=f+10,l.rounding=1,n=Math.min(28,a/I+2|0),e=n;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(C=!1,t=Math.ceil(a/I),r=1,c=u.times(u),s=new l(u),i=u;e!==-1;)if(i=i.times(c),o=s.minus(i.div(r+=2)),i=i.times(c),s=o.plus(i.div(r+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===o.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),C=!0,S(s,l.precision=f,l.rounding=m,!0)};p.isFinite=function(){return!!this.d};p.isInteger=p.isInt=function(){return!!this.d&&H(this.e/I)>this.d.length-2};p.isNaN=function(){return!this.s};p.isNegative=p.isNeg=function(){return this.s<0};p.isPositive=p.isPos=function(){return this.s>0};p.isZero=function(){return!!this.d&&this.d[0]===0};p.lessThan=p.lt=function(e){return this.cmp(e)<0};p.lessThanOrEqualTo=p.lte=function(e){return this.cmp(e)<1};p.logarithm=p.log=function(e){var t,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,m=l.rounding,d=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new l(n&&!n[0]?-1/0:u.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(C=!1,a=f+d,s=se(u,a),r=t?Ge(l,a+10):se(e,a),c=V(s,r,a,1),ke(c.d,i=f,m))do if(a+=10,s=se(u,a),r=t?Ge(l,a+10):se(e,a),c=V(s,r,a,1),!o){+j(c.d).slice(i+1,i+15)+1==1e14&&(c=S(c,f+1,0));break}while(ke(c.d,i+=10,m));return C=!0,S(c,f,m)};p.minus=p.sub=function(e){var t,n,r,i,o,s,a,c,u,l,f,m,d=this,h=d.constructor;if(e=new h(e),!d.d||!e.d)return!d.s||!e.s?e=new h(NaN):d.d?e.s=-e.s:e=new h(e.d||d.s!==e.s?d:NaN),e;if(d.s!=e.s)return e.s=-e.s,d.plus(e);if(u=d.d,m=e.d,a=h.precision,c=h.rounding,!u[0]||!m[0]){if(m[0])e.s=-e.s;else if(u[0])e=new h(d);else return new h(c===3?-0:0);return C?S(e,a,c):e}if(n=H(e.e/I),l=H(d.e/I),u=u.slice(),o=l-n,o){for(f=o<0,f?(t=u,o=-o,s=m.length):(t=m,n=l,s=u.length),r=Math.max(Math.ceil(a/I),s)+2,o>r&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for(r=u.length,s=m.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(u[r]!=m[r]){f=u[r]<m[r];break}o=0}for(f&&(t=u,u=m,m=t,e.s=-e.s),s=u.length,r=m.length-s;r>0;--r)u[s++]=0;for(r=m.length;r>o;){if(u[--r]<m[r]){for(i=r;i&&u[--i]===0;)u[i]=Y-1;--u[i],u[r]+=Y}u[r]-=m[r]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--n;return u[0]?(e.d=u,e.e=He(u,n),C?S(e,a,c):e):new h(c===3?-0:0)};p.modulo=p.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?S(new r(n),r.precision,r.rounding):(C=!1,r.modulo==9?(t=V(n,e.abs(),0,3,1),t.s*=e.s):t=V(n,e,0,r.modulo,1),t=t.times(e),C=!0,n.minus(t))};p.naturalExponential=p.exp=function(){return pt(this)};p.naturalLogarithm=p.ln=function(){return se(this)};p.negated=p.neg=function(){var e=new this.constructor(this);return e.s=-e.s,S(e)};p.plus=p.add=function(e){var t,n,r,i,o,s,a,c,u,l,f=this,m=f.constructor;if(e=new m(e),!f.d||!e.d)return!f.s||!e.s?e=new m(NaN):f.d||(e=new m(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(u=f.d,l=e.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(e=new m(f)),C?S(e,a,c):e;if(o=H(f.e/I),r=H(e.e/I),u=u.slice(),i=o-r,i){for(i<0?(n=u,i=-i,s=l.length):(n=l,r=o,s=u.length),o=Math.ceil(a/I),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,n=l,l=u,u=n),t=0;i;)t=(u[--i]=u[i]+l[i]+t)/Y|0,u[i]%=Y;for(t&&(u.unshift(t),++r),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=He(u,r),C?S(e,a,c):e};p.precision=p.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(ae+e);return n.d?(t=$t(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};p.round=function(){var e=this,t=e.constructor;return S(new t(e),e.e+1,t.rounding)};p.sine=p.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+I,r.rounding=1,n=Un(r,rn(r,n)),r.precision=e,r.rounding=t,S(te>2?n.neg():n,e,t,!0)):new r(NaN)};p.squareRoot=p.sqrt=function(){var e,t,n,r,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(C=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=j(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=H((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),r=new l(t)):r=new l(u.toString()),n=(c=l.precision)+3;;)if(o=r,r=o.plus(V(s,o,n+2,1)).times(.5),j(o.d).slice(0,n)===(t=j(r.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!i&&t=="4999"){if(!i&&(S(o,c+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(S(r,c+1,1),e=!r.times(r).eq(s));break}return C=!0,S(r,c,l.rounding,e)};p.tangent=p.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,n=n.sin(),n.s=1,n=V(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,S(te==2||te==4?n.neg():n,e,t,!0)):new r(NaN)};p.times=p.mul=function(e){var t,n,r,i,o,s,a,c,u,l=this,f=l.constructor,m=l.d,d=(e=new f(e)).d;if(e.s*=l.s,!m||!m[0]||!d||!d[0])return new f(!e.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?e.s/0:e.s*0);for(n=H(l.e/I)+H(e.e/I),c=m.length,u=d.length,c<u&&(o=m,m=d,d=o,s=c,c=u,u=s),o=[],s=c+u,r=s;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,i=c+r;i>r;)a=o[i]+d[r]*m[i-r-1]+t,o[i--]=a%Y|0,t=a/Y|0;o[i]=(o[i]+t)%Y|0}for(;!o[--s];)o.pop();return t?++n:o.shift(),e.d=o,e.e=He(o,n),C?S(e,f.precision,f.rounding):e};p.toBinary=function(e,t){return gt(this,2,e,t)};p.toDecimalPlaces=p.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(z(e,0,ue),t===void 0?t=r.rounding:z(t,0,8),S(n,e+n.e+1,t))};p.toExponential=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=$(r,!0):(z(e,0,ue),t===void 0?t=i.rounding:z(t,0,8),r=S(new i(r),e+1,t),n=$(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n};p.toFixed=function(e,t){var n,r,i=this,o=i.constructor;return e===void 0?n=$(i):(z(e,0,ue),t===void 0?t=o.rounding:z(t,0,8),r=S(new o(i),e+i.e+1,t),n=$(r,!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};p.toFraction=function(e){var t,n,r,i,o,s,a,c,u,l,f,m,d=this,h=d.d,g=d.constructor;if(!h)return new g(d);if(u=n=new g(1),r=c=new g(0),t=new g(r),o=t.e=$t(h)-d.e-1,s=o%I,t.d[0]=q(10,s<0?I+s:s),e==null)e=o>0?t:u;else{if(a=new g(e),!a.isInt()||a.lt(u))throw Error(ae+a);e=a.gt(t)?o>0?t:u:a}for(C=!1,a=new g(j(h)),l=g.precision,g.precision=o=h.length*I*2;f=V(a,t,0,1,1),i=n.plus(f.times(r)),i.cmp(e)!=1;)n=r,r=i,i=u,u=c.plus(f.times(i)),c=i,i=t,t=a.minus(f.times(i)),a=i;return i=V(e.minus(n),r,0,1,1),c=c.plus(i.times(u)),n=n.plus(i.times(r)),c.s=u.s=d.s,m=V(u,r,o,1).minus(d).abs().cmp(V(c,n,o,1).minus(d).abs())<1?[u,r]:[c,n],g.precision=l,C=!0,m};p.toHexadecimal=p.toHex=function(e,t){return gt(this,16,e,t)};p.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),e==null){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:z(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(C=!1,n=V(n,e,0,t,1).times(e),C=!0,S(n)):(e.s=n.s,n=e),n};p.toNumber=function(){return+this};p.toOctal=function(e,t){return gt(this,8,e,t)};p.toPower=p.pow=function(e){var t,n,r,i,o,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c(q(+a,u));if(a=new c(a),a.eq(1))return a;if(r=c.precision,o=c.rounding,e.eq(1))return S(a,r,o);if(t=H(e.e/I),t>=e.d.length-1&&(n=u<0?-u:u)<=Fn)return i=en(c,a,n,r),e.s<0?new c(1).div(i):S(i,r,o);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=q(+a,u),t=n==0||!isFinite(n)?H(u*(Math.log("0."+j(a.d))/Math.LN10+a.e+1)):new c(n+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(C=!1,c.rounding=a.s=1,n=Math.min(12,(t+"").length),i=pt(e.times(se(a,r+n)),r),i.d&&(i=S(i,r+5,1),ke(i.d,r,o)&&(t=r+10,i=S(pt(e.times(se(a,t+n)),t),t+5,1),+j(i.d).slice(r+1,r+15)+1==1e14&&(i=S(i,r+1,0)))),i.s=s,C=!0,c.rounding=o,S(i,r,o))};p.toPrecision=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=$(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(z(e,1,ue),t===void 0?t=i.rounding:z(t,0,8),r=S(new i(r),e,t),n=$(r,e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n};p.toSignificantDigits=p.toSD=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(z(e,1,ue),t===void 0?t=r.rounding:z(t,0,8)),S(new r(n),e,t)};p.toString=function(){var e=this,t=e.constructor,n=$(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};p.truncated=p.trunc=function(){return S(new this.constructor(this),this.e+1,1)};p.valueOf=p.toJSON=function(){var e=this,t=e.constructor,n=$(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function j(e){var t,n,r,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)r=e[t]+"",n=I-r.length,n&&(o+=oe(n)),o+=r;s=e[t],r=s+"",n=I-r.length,n&&(o+=oe(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function z(e,t,n){if(e!==~~e||e<t||e>n)throw Error(ae+e)}function ke(e,t,n,r){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=I,i=0):(i=Math.ceil((t+1)/I),t%=I),o=q(10,I-t),a=e[i]%o|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(e[i+1]/o/100|0)==q(10,t-2)-1||(a==o/2||a==0)&&(e[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==q(10,t-3)-1,s}function We(e,t,n){for(var r,i=[0],o,s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=lt.indexOf(e.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function Vn(e,t){var n,r,i;if(t.isZero())return t;r=t.d.length,r<32?(n=Math.ceil(r/3),i=(1/Ze(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=be(e,1,t.times(i),new e(1));for(var o=n;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var V=function(){function e(r,i,o){var s,a=0,c=r.length;for(r=r.slice();c--;)s=r[c]*i+a,r[c]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function t(r,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(r[a]!=i[a]){c=r[a]>i[a]?1:-1;break}return c}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,c){var u,l,f,m,d,h,g,b,P,x,A,y,w,T,N,B,R,O,v,E,_=r.constructor,W=r.s==i.s?1:-1,K=r.d,L=i.d;if(!K||!K[0]||!L||!L[0])return new _(!r.s||!i.s||(K?L&&K[0]==L[0]:!L)?NaN:K&&K[0]==0||!L?W*0:W/0);for(c?(d=1,l=r.e-i.e):(c=Y,d=I,l=H(r.e/d)-H(i.e/d)),v=L.length,R=K.length,P=new _(W),x=P.d=[],f=0;L[f]==(K[f]||0);f++);if(L[f]>(K[f]||0)&&l--,o==null?(T=o=_.precision,s=_.rounding):a?T=o+(r.e-i.e)+1:T=o,T<0)x.push(1),h=!0;else{if(T=T/d+2|0,f=0,v==1){for(m=0,L=L[0],T++;(f<R||m)&&T--;f++)N=m*c+(K[f]||0),x[f]=N/L|0,m=N%L|0;h=m||f<R}else{for(m=c/(L[0]+1)|0,m>1&&(L=e(L,m,c),K=e(K,m,c),v=L.length,R=K.length),B=v,A=K.slice(0,v),y=A.length;y<v;)A[y++]=0;E=L.slice(),E.unshift(0),O=L[0],L[1]>=c/2&&++O;do m=0,u=t(L,A,v,y),u<0?(w=A[0],v!=y&&(w=w*c+(A[1]||0)),m=w/O|0,m>1?(m>=c&&(m=c-1),g=e(L,m,c),b=g.length,y=A.length,u=t(g,A,b,y),u==1&&(m--,n(g,v<b?E:L,b,c))):(m==0&&(u=m=1),g=L.slice()),b=g.length,b<y&&g.unshift(0),n(A,g,y,c),u==-1&&(y=A.length,u=t(L,A,v,y),u<1&&(m++,n(A,v<y?E:L,y,c))),y=A.length):u===0&&(m++,A=[0]),x[f++]=m,u&&A[0]?A[y++]=K[B]||0:(A=[K[B]],y=1);while((B++<R||A[0]!==void 0)&&T--);h=A[0]!==void 0}x[0]||x.shift()}if(d==1)P.e=l,zt=h;else{for(f=1,m=x[0];m>=10;m/=10)f++;P.e=f+l*d-1,S(P,a?o+P.e+1:o,s,h)}return P}}();function S(e,t,n,r){var i,o,s,a,c,u,l,f,m,d=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(i=1,a=f[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=I,s=t,l=f[m=0],c=l/q(10,i-s-1)%10|0;else if(m=Math.ceil((o+1)/I),a=f.length,m>=a)if(r){for(;a++<=m;)f.push(0);l=c=0,i=1,o%=I,s=o-I+1}else break e;else{for(l=a=f[m],i=1;a>=10;a/=10)i++;o%=I,s=o-I+i,c=s<0?0:l/q(10,i-s-1)%10|0}if(r=r||t<0||f[m+1]!==void 0||(s<0?l:l%q(10,i-s-1)),u=n<4?(c||r)&&(n==0||n==(e.s<0?3:2)):c>5||c==5&&(n==4||r||n==6&&(o>0?s>0?l/q(10,i-s):0:f[m-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,u?(t-=e.e+1,f[0]=q(10,(I-t%I)%I),e.e=-t||0):f[0]=e.e=0,e;if(o==0?(f.length=m,a=1,m--):(f.length=m+1,a=q(10,I-o),f[m]=s>0?(l/q(10,i-s)%q(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,f[0]==Y&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=Y)break;f[m--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return C&&(e.e>d.maxE?(e.d=null,e.e=NaN):e.e<d.minE&&(e.e=0,e.d=[0])),e}function $(e,t,n){if(!e.isFinite())return nn(e);var r,i=e.e,o=j(e.d),s=o.length;return t?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+oe(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+oe(-i-1)+o,n&&(r=n-s)>0&&(o+=oe(r))):i>=s?(o+=oe(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+oe(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=oe(r))),o}function He(e,t){var n=e[0];for(t*=I;n>=10;n/=10)t++;return t}function Ge(e,t,n){if(t>Kn)throw C=!0,n&&(e.precision=n),Error(Xt);return S(new e(Ue),t,1,!0)}function Q(e,t,n){if(t>mt)throw Error(Xt);return S(new e(qe),t,n,!0)}function $t(e){var t=e.length-1,n=t*I+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function oe(e){for(var t="";e--;)t+="0";return t}function en(e,t,n,r){var i,o=new e(1),s=Math.ceil(r/I+4);for(C=!1;;){if(n%2&&(o=o.times(t),Ht(o.d,s)&&(i=!0)),n=H(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}t=t.times(t),Ht(t.d,s)}return C=!0,o}function jt(e){return e.d[e.d.length-1]&1}function tn(e,t,n){for(var r,i=new e(t[0]),o=0;++o<t.length;)if(r=new e(t[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function pt(e,t){var n,r,i,o,s,a,c,u=0,l=0,f=0,m=e.constructor,d=m.rounding,h=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(C=!1,c=h):c=t,a=new m(.03125);e.e>-2;)e=e.times(a),f+=5;for(r=Math.log(q(2,f))/Math.LN10*2+5|0,c+=r,n=o=s=new m(1),m.precision=c;;){if(o=S(o.times(e),c,1),n=n.times(++l),a=s.plus(V(o,n,c,1)),j(a.d).slice(0,c)===j(s.d).slice(0,c)){for(i=f;i--;)s=S(s.times(s),c,1);if(t==null)if(u<3&&ke(s.d,c-r,d,u))m.precision=c+=10,n=o=a=new m(1),l=0,u++;else return S(s,m.precision=h,d,C=!0);else return m.precision=h,s}s=a}}function se(e,t){var n,r,i,o,s,a,c,u,l,f,m,d=1,h=10,g=e,b=g.d,P=g.constructor,x=P.rounding,A=P.precision;if(g.s<0||!b||!b[0]||!g.e&&b[0]==1&&b.length==1)return new P(b&&!b[0]?-1/0:g.s!=1?NaN:b?0:g);if(t==null?(C=!1,l=A):l=t,P.precision=l+=h,n=j(b),r=n.charAt(0),Math.abs(o=g.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)g=g.times(e),n=j(g.d),r=n.charAt(0),d++;o=g.e,r>1?(g=new P("0."+n),o++):g=new P(r+"."+n.slice(1))}else return u=Ge(P,l+2,A).times(o+""),g=se(new P(r+"."+n.slice(1)),l-h).plus(u),P.precision=A,t==null?S(g,A,x,C=!0):g;for(f=g,c=s=g=V(g.minus(1),g.plus(1),l,1),m=S(g.times(g),l,1),i=3;;){if(s=S(s.times(m),l,1),u=c.plus(V(s,new P(i),l,1)),j(u.d).slice(0,l)===j(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Ge(P,l+2,A).times(o+""))),c=V(c,new P(d),l,1),t==null)if(ke(c.d,l-h,x,a))P.precision=l+=h,u=s=g=V(f.minus(1),f.plus(1),l,1),m=S(g.times(g),l,1),i=a=1;else return S(c,P.precision=A,x,C=!0);else return P.precision=A,c;c=u,i+=2}}function nn(e){return String(e.s*e.s/0)}function dt(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;r++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(r,i),t){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%I,n<0&&(r+=I),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=I;r<i;)e.d.push(+t.slice(r,r+=I));t=t.slice(r),r=I-t.length}else r-=i;for(;r--;)t+="0";e.d.push(+t),C&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Wn(e,t){var n,r,i,o,s,a,c,u,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Yt.test(t))return dt(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(_n.test(t))n=16,t=t.toLowerCase();else if(vn.test(t))n=2;else if(On.test(t))n=8;else throw Error(ae+t);for(o=t.search(/p/i),o>0?(c=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,r=e.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=en(r,new r(n),o,o*2)),u=We(t,n,Y),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new r(e.s*0):(e.e=He(u,l),e.d=u,C=!1,s&&(e=V(e,i,a*4)),c&&(e=e.times(Math.abs(c)<54?q(2,c):ze.pow(2,c))),C=!0,e)}function Un(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:be(e,2,t,t);n=1.4*Math.sqrt(r),n=n>16?16:n|0,t=t.times(1/Ze(5,n)),t=be(e,2,t,t);for(var i,o=new e(5),s=new e(16),a=new e(20);n--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function be(e,t,n,r,i){var o,s,a,c,u=1,l=e.precision,f=Math.ceil(l/I);for(C=!1,c=n.times(n),a=new e(r);;){if(s=V(a.times(c),new e(t++*t++),l,1),a=i?r.plus(s):r.minus(s),r=V(s.times(c),new e(t++*t++),l,1),s=a.plus(r),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,u++}return C=!0,s.d.length=f+1,s}function Ze(e,t){for(var n=e;--t;)n*=e;return n}function rn(e,t){var n,r=t.s<0,i=Q(e,e.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return te=r?4:1,t;if(n=t.divToInt(i),n.isZero())te=r?3:2;else{if(t=t.minus(n.times(i)),t.lte(o))return te=jt(n)?r?2:3:r?4:1,t;te=jt(n)?r?1:4:r?3:2}return t.minus(i).abs()}function gt(e,t,n,r){var i,o,s,a,c,u,l,f,m,d=e.constructor,h=n!==void 0;if(h?(z(n,1,ue),r===void 0?r=d.rounding:z(r,0,8)):(n=d.precision,r=d.rounding),!e.isFinite())l=nn(e);else{for(l=$(e),s=l.indexOf("."),h?(i=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):i=t,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=We($(m),10,i),m.e=m.d.length),f=We(l,10,i),o=c=f.length;f[--c]==0;)f.pop();if(!f[0])l=h?"0p+0":"0";else{if(s<0?o--:(e=new d(e),e.d=f,e.e=o,e=V(e,m,n,r,0,i),f=e.d,o=e.e,u=zt),s=f[n],a=i/2,u=u||f[n+1]!==void 0,u=r<4?(s!==void 0||u)&&(r===0||r===(e.s<0?3:2)):s>a||s===a&&(r===4||u||r===6&&f[n-1]&1||r===(e.s<0?8:7)),f.length=n,u)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(c=f.length;!f[c-1];--c);for(s=0,l="";s<c;s++)l+=lt.charAt(f[s]);if(h){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)l+="0";for(f=We(l,i,t),c=f.length;!f[c-1];--c);for(s=1,l="1.";s<c;s++)l+=lt.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function Ht(e,t){if(e.length>t)return e.length=t,!0}function qn(e){return new this(e).abs()}function Gn(e){return new this(e).acos()}function jn(e){return new this(e).acosh()}function Hn(e,t){return new this(e).plus(t)}function Zn(e){return new this(e).asin()}function zn(e){return new this(e).asinh()}function Xn(e){return new this(e).atan()}function Jn(e){return new this(e).atanh()}function Qn(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,o=r+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=Q(this,o,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?Q(this,r,i):new this(0),n.s=e.s):!e.d||t.isZero()?(n=Q(this,o,1).times(.5),n.s=e.s):t.s<0?(this.precision=o,this.rounding=1,n=this.atan(V(e,t,o,1)),t=Q(this,o,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(V(e,t,o,1)),n}function Yn(e){return new this(e).cbrt()}function $n(e){return S(e=new this(e),e.e+1,2)}function er(e,t,n){return new this(e).clamp(t,n)}function tr(e){if(!e||typeof e!="object")throw Error(je+"Object expected");var t,n,r,i=e.defaults===!0,o=["precision",1,ue,"rounding",0,8,"toExpNeg",-he,0,"toExpPos",0,he,"maxE",0,he,"minE",-he,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(n=o[t],i&&(this[n]=ft[n]),(r=e[n])!==void 0)if(H(r)===r&&r>=o[t+1]&&r<=o[t+2])this[n]=r;else throw Error(ae+n+": "+r);if(n="crypto",i&&(this[n]=ft[n]),(r=e[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Jt);else this[n]=!1;else throw Error(ae+n+": "+r);return this}function nr(e){return new this(e).cos()}function rr(e){return new this(e).cosh()}function on(e){var t,n,r;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,Zt(o)){u.s=o.s,C?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;C?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return dt(u,o.toString())}else if(c!=="string")throw Error(ae+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Yt.test(o)?dt(u,o):Wn(u,o)}if(i.prototype=p,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=tr,i.clone=on,i.isDecimal=Zt,i.abs=qn,i.acos=Gn,i.acosh=jn,i.add=Hn,i.asin=Zn,i.asinh=zn,i.atan=Xn,i.atanh=Jn,i.atan2=Qn,i.cbrt=Yn,i.ceil=$n,i.clamp=er,i.cos=nr,i.cosh=rr,i.div=ir,i.exp=or,i.floor=sr,i.hypot=ar,i.ln=ur,i.log=cr,i.log10=fr,i.log2=lr,i.max=mr,i.min=pr,i.mod=dr,i.mul=gr,i.pow=hr,i.random=br,i.round=yr,i.sign=wr,i.sin=Tr,i.sinh=Pr,i.sqrt=xr,i.sub=Ar,i.sum=Sr,i.tan=kr,i.tanh=Ir,i.trunc=Br,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return i.config(e),i}function ir(e,t){return new this(e).div(t)}function or(e){return new this(e).exp()}function sr(e){return S(e=new this(e),e.e+1,3)}function ar(){var e,t,n=new this(0);for(C=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return C=!0,new this(1/0);n=t}return C=!0,n.sqrt()}function Zt(e){return e instanceof ze||e&&e.toStringTag===Qt||!1}function ur(e){return new this(e).ln()}function cr(e,t){return new this(e).log(t)}function lr(e){return new this(e).log(2)}function fr(e){return new this(e).log(10)}function mr(){return tn(this,arguments,"lt")}function pr(){return tn(this,arguments,"gt")}function dr(e,t){return new this(e).mod(t)}function gr(e,t){return new this(e).mul(t)}function hr(e,t){return new this(e).pow(t)}function br(e){var t,n,r,i,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:z(e,1,ue),r=Math.ceil(e/I),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(Jt);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],e%=I,r&&e&&(i=q(10,I-e),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=I)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<I&&(n-=I-r)}return s.e=n,s.d=a,s}function yr(e){return S(e=new this(e),e.e+1,this.rounding)}function wr(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function Tr(e){return new this(e).sin()}function Pr(e){return new this(e).sinh()}function xr(e){return new this(e).sqrt()}function Ar(e,t){return new this(e).sub(t)}function Sr(){var e=0,t=arguments,n=new this(t[e]);for(C=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return C=!0,S(n,this.precision,this.rounding)}function kr(e){return new this(e).tan()}function Ir(e){return new this(e).tanh()}function Br(e){return S(e=new this(e),e.e+1,1)}p[Symbol.for("nodejs.util.inspect.custom")]=p.toString;p[Symbol.toStringTag]="Decimal";var ze=p.constructor=on(ft);Ue=new ze(Ue);qe=new ze(qe);import{PublicKey as Cr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as sn}from"@solana/spl-token";var an={chainId:101,address:Cr.default.toBase58(),programId:sn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},fe={chainId:101,address:"So11111111111111111111111111111111111111112",programId:sn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as ht}from"@solana/web3.js";var bt=class{constructor({mint:t,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===Se.toBase58()||t instanceof ht&&Se.equals(t)){this.decimals=fe.decimals,this.symbol=fe.symbol,this.name=fe.name,this.mint=new ht(fe.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?ht.default:Ut({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},me=bt;me.WSOL=new bt(J(G({},fe),{mint:fe.address}));var yt=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},Xe=yt;Xe.SOL=new yt(an);import Qe from"big.js";import Er from"bn.js";import vr from"decimal.js-light";import{get as un,set as Lr}from"lodash";var wt=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},cn={},Nr={};function Z(e){let t=un(cn,e);if(!t){let n=un(Nr,e);t=new wt({name:e,logLevel:n}),Lr(cn,e,t)}return t}import Ie from"bn.js";var ln=9007199254740991;function X(e){let t=Z("Raydium_parseBigNumberish");if(e instanceof Ie)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new Ie(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=ln||e<=-ln)&&t.logWithError(`BigNumberish number overflow: ${e}`),new Ie(String(e))):typeof e=="bigint"?new Ie(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new Ie(0))}import Rr from"toformat";var Mr=Rr,Be=Mr;var Je=Z("module/fraction"),Tt=Be(Qe),Ce=Be(vr),_r={[0]:Ce.ROUND_DOWN,[1]:Ce.ROUND_HALF_UP,[2]:Ce.ROUND_UP},Or={[0]:Qe.roundDown,[1]:Qe.roundHalfUp,[2]:Qe.roundUp},F=class{constructor(t,n=new Er(1)){this.numerator=X(t),this.denominator=X(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new F(this.denominator,this.numerator)}add(t){let n=t instanceof F?t:new F(X(t));return this.denominator.eq(n.denominator)?new F(this.numerator.add(n.numerator),this.denominator):new F(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof F?t:new F(X(t));return this.denominator.eq(n.denominator)?new F(this.numerator.sub(n.numerator),this.denominator):new F(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof F?t:new F(X(t));return new F(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof F?t:new F(X(t));return new F(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||Je.logWithError(`${t} is not an integer.`),t<=0&&Je.logWithError(`${t} is not positive.`),Ce.set({precision:t+1,rounding:_r[r]});let i=new Ce(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||Je.logWithError(`${t} is not an integer.`),t<0&&Je.logWithError(`${t} is negative.`),Tt.DP=t,Tt.RM=Or[r]||1,new Tt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};import Fr from"bn.js";var fn=new F(new Fr(100)),ye=class extends F{toSignificant(t=5,n,r){return this.mul(fn).toSignificant(t,n,r)}toFixed(t=2,n,r){return this.mul(fn).toFixed(t,n,r)}};var Kr=Z("Raydium_price"),ne=class extends F{constructor(n){let{baseToken:r,quoteToken:i,numerator:o,denominator:s}=n;super(o,s);this.baseToken=r,this.quoteToken=i,this.scalar=new F(Pt(r.decimals),Pt(i.decimals))}get raw(){return new F(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new ne({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(n){this.quoteToken!==n.baseToken&&Kr.logWithError("mul token not equals");let r=super.mul(n);return new ne({baseToken:this.baseToken,quoteToken:n.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(n=this.quoteToken.decimals,r,i){return this.adjusted.toSignificant(n,r,i)}toFixed(n=this.quoteToken.decimals,r,i){return this.adjusted.toFixed(n,r,i)}};var Vr=new ie(0),rs=new ie(1),is=new ie(2),os=new ie(3),ss=new ie(5),xt=new ie(10),as=new ie(100),us=new ie(1e3),cs=new ie(1e4);function Pt(e){return xt.pow(X(e))}import{PublicKey as Wr}from"@solana/web3.js";import{MINT_SIZE as Ts,TOKEN_PROGRAM_ID as Ps,getTransferFeeConfig as xs,unpackMint as As}from"@solana/spl-token";var At=Z("Raydium_accountInfo_util");async function pn(e,t,n){let{batchRequest:r,commitment:i="confirmed",chunkCount:o=100}=G({batchRequest:!1},n),s=St(t,o),a=new Array(s.length).fill([]);if(r){let c=s.map(f=>{let m=e._buildArgs([f.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=St(c,10);a=(await(await Promise.all(u.map(async f=>await e._rpcBatchRequest(f)))).flat()).map(f=>(f.error&&At.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.error.message}`),f.result.value.map(m=>{if(m){let{data:d,executable:h,lamports:g,owner:b,rentEpoch:P}=m;return d.length!==2&&d[1]!=="base64"&&At.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:h,lamports:g,owner:new Wr(b),rentEpoch:P}}return null})))}else try{a=await Promise.all(s.map(c=>e.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&At.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}function St(e,t=1,n=[]){let r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}import{PublicKey as Us}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Gs}from"@solana/spl-token";import{ComputeBudgetProgram as dn,Keypair as hn,PublicKey as Ds,Transaction as bn,TransactionMessage as Ur,VersionedTransaction as yn}from"@solana/web3.js";var Le={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as qr}from"@solana/spl-token";var gn=Z("Raydium_txUtil"),wn=1644;function Ye(e){let t=[],n=[];return e.microLamports&&(t.push(dn.setComputeUnitPrice({microLamports:e.microLamports})),n.push(Le.SetComputeUnitPrice)),e.units&&(t.push(dn.setComputeUnitLimit({units:e.units})),n.push(Le.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function we(e,t){var r,i;let n=t!=null?t:"confirmed";return(i=await((r=e.getLatestBlockhash)==null?void 0:r.call(e,{commitment:n})))==null?void 0:i.blockhash}async function $e(e,t){return e.getSignatureStatuses([t]),new Promise((n,r)=>{let i=setTimeout(r,6e4);e.onSignature(t,o=>{if(clearTimeout(i),!o.err){n("");return}r(Object.assign(o.err,{txId:t}))},"confirmed")})}function Gr(e,t){e.length<1&&gn.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&gn.logWithError(`no signers provided:, ${t.toString()}`);let n=new bn;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<wn}catch{return!1}}function Ne({instructions:e,payer:t,signers:n}){return Gr(e,[t,...n])}function Re({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:r=hn.generate().publicKey.toString()}){let o=new Ur({payerKey:t,recentBlockhash:r,instructions:e}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new yn(o).serialize()).toString("base64").length<wn}catch{return!1}}var jr=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e),Hr=e=>{let t=e.serialize({requireAllSignatures:!1,verifySignatures:!1});e instanceof yn&&(t=jr(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function pe(e){let t=[];return e.forEach(n=>{n instanceof bn&&(n.recentBlockhash||(n.recentBlockhash=qr.toBase58()),n.feePayer||(n.feePayer=hn.generate().publicKey)),t.push(Hr(n))}),console.log("simulate tx string:",t),t}import zs from"bn.js";import{PublicKey as kt,AddressLookupTableAccount as Pe}from"@solana/web3.js";async function It({connection:e,address:t,cluster:n="mainnet"}){let r=await pn(e,[...new Set(t.map(o=>o.toString()))].map(o=>new kt(o))),i={};for(let o=0;o<t.length;o++){let s=r[o],a=t[o];if(!s)continue;let c=new Pe({key:a,state:Pe.deserialize(s.data)});i[a.toString()]=c,n==="devnet"?Te[a.toString()]=c:et[a.toString()]=c}return i}var et={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Pe({key:new kt("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Pe.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})},Te={},Bt=async e=>{let t="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(Te[t])return Te;let n=new kt(t),r=await e.getAccountInfo(n);return r&&(Te[t]=new Pe({key:n,state:Pe.deserialize(r.data)})),Te};import{PublicKey as xe,sendAndConfirmTransaction as Ct,SystemProgram as Zr,Transaction as Me,TransactionMessage as De,VersionedTransaction as Ee}from"@solana/web3.js";import zr from"axios";var tt=2e3,nt=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.loopMultiTxStatus=!!t.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await zr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=t==null?void 0:t[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:n,instructionTypes:r}=Ye(t);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}addTipInstruction(t){var n;return t?(this.endInstructions.push(Zr.transfer({fromPubkey:(n=t.feePayer)!=null?n:this.feePayer,toPubkey:new xe(t.address),lamports:BigInt(t.amount.toString())})),this.endInstructionTypes.push(Le.TransferTip),!0):!1}async calComputeBudget({config:t,defaultIns:n}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==xe.default.toString())),this}async versionBuild({txVersion:t,extInfo:n}){return t===0?await this.buildV0(G({},n||{})):this.build(n)}build(t){var r;let n=new Me;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var l;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=i||{},u=o!=null?o:await we(this.connection,this.blockhashCommitment);if(n.recentBlockhash=u,this.signers.length&&n.sign(...this.signers),pe([n]),(l=this.owner)!=null&&l.isKeyPair)return{txId:a?await Ct(this.connection,n,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(n.serialize(),{skipPreflight:s}),signedTx:n};if(this.signAllTransactions){let f=await this.signAllTransactions([n]);if(this.signers.length)for(let m of f)try{m.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(f[0].serialize(),{skipPreflight:s}),signedTx:f[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var u;let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:i}=this.build(r),o=n.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var P;let{sequentially:f,onTxUpdate:m,skipTxCount:d=0,recentBlockHash:h,skipPreflight:g=!0}=l||{},b=h!=null?h:await we(this.connection,this.blockhashCommitment);if((P=this.owner)!=null&&P.isKeyPair){if(f){let x=[],A=0;for(let y of s){if(++A,A<=d)continue;let w=await Ct(this.connection,y,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});x.push(w)}return{txIds:x,signedTxs:s}}return{txIds:await await Promise.all(s.map(async x=>(x.recentBlockhash=b,await this.connection.sendRawTransaction(x.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let x=s.map((y,w)=>(y.recentBlockhash=b,a[w].length&&y.sign(...a[w]),y));pe(x);let A=await this.signAllTransactions(x);if(f){let y=0,w=[],T=async()=>{if(!A[y])return;let N=await this.connection.sendRawTransaction(A[y].serialize(),{skipPreflight:g});w.push({txId:N,status:"sent",signedTx:A[y]}),m==null||m([...w]),y++;let B=!1,R=null,O=null,v=E=>{R!==null&&clearInterval(R),O!==null&&this.connection.removeSignatureListener(O);let _=w.findIndex(W=>W.txId===N);if(_>-1){if(w[_].status==="error"||w[_].status==="success")return;w[_].status=E.err?"error":"success"}m==null||m([...w]),E.err||T()};this.loopMultiTxStatus&&(R=setInterval(async()=>{var E;if(B){clearInterval(R);return}try{let _=await this.connection.getTransaction(N,{commitment:"confirmed",maxSupportedTransactionVersion:0});_&&(B=!0,clearInterval(R),v({err:((E=_.meta)==null?void 0:E.err)||null}),console.log("tx status from getTransaction:",N))}catch(_){B=!0,clearInterval(R),console.error("getTransaction timeout:",_,N)}},tt)),O=this.connection.onSignature(N,E=>{if(B){this.connection.removeSignatureListener(O);return}B=!0,v(E)},"confirmed"),this.connection.getSignatureStatus(N)};return await T(),{txIds:w.map(N=>N.txId),signedTxs:A}}else{let y=[];for(let w=0;w<A.length;w+=1){let T=await this.connection.sendRawTransaction(A[w].serialize(),{skipPreflight:g});y.push(T)}return{txIds:y,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){var g;let h=t||{},{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:i,recentBlockhash:o}=h,s=Ve(h,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=G(G({},this.cluster==="devnet"?await Bt(this.connection):et),n),c=Array.from(new Set([...r,...this.lookupTableAddress])),u=[];for(let b of c)a[b]===void 0&&u.push(new xe(b));let l=await It({connection:this.connection,address:u});for(let[b,P]of Object.entries(l))a[b]=P;let f=i?xe.default.toBase58():o!=null?o:await we(this.connection,this.blockhashCommitment),m=new De({payerKey:this.feePayer,recentBlockhash:f,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new Ee(m);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var y;let{skipPreflight:P=!0,sendAndConfirm:x,notSendToRpc:A}=b||{};if(pe([d]),(y=this.owner)!=null&&y.isKeyPair){let w=await this.connection.sendTransaction(d,{skipPreflight:P});return x&&await $e(this.connection,w),{txId:w,signedTx:d}}if(this.signAllTransactions){let w=await this.signAllTransactions([d]);if(this.signers.length)for(let T of w)try{T.sign(this.signers)}catch{}return{txId:A?"":await this.connection.sendTransaction(w[0],{skipPreflight:P}),signedTx:w[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(t){var u;let{extraPreBuildData:n=[],buildProps:r}=t,{transaction:i}=await this.buildV0(r),o=n.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,f)=>{l.sign(a[f])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:r,execute:async l=>{var g;let{sequentially:f,onTxUpdate:m,recentBlockHash:d,skipPreflight:h=!0}=l||{};if(d&&s.forEach(b=>b.message.recentBlockhash=d),pe(s),(g=this.owner)!=null&&g.isKeyPair){if(f){let b=[];for(let P of s){let x=await this.connection.sendTransaction(P,{skipPreflight:h});await $e(this.connection,x),b.push(x)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:h}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(f){let P=0,x=[],A=async()=>{if(!b[P])return;let y=await this.connection.sendTransaction(b[P],{skipPreflight:h});x.push({txId:y,status:"sent",signedTx:b[P]}),m==null||m([...x]),P++;let w=!1,T=null,N=null,B=R=>{T!==null&&clearInterval(T),N!==null&&this.connection.removeSignatureListener(N);let O=x.findIndex(v=>v.txId===y);if(O>-1){if(x[O].status==="error"||x[O].status==="success")return;x[O].status=R.err?"error":"success"}m==null||m([...x]),R.err||A()};this.loopMultiTxStatus&&(T=setInterval(async()=>{var R;if(w){clearInterval(T);return}try{let O=await this.connection.getTransaction(y,{commitment:"confirmed",maxSupportedTransactionVersion:0});O&&(w=!0,clearInterval(T),B({err:((R=O.meta)==null?void 0:R.err)||null}),console.log("tx status from getTransaction:",y))}catch(O){w=!0,clearInterval(T),console.error("getTransaction timeout:",O,y)}},tt)),N=this.connection.onSignature(y,R=>{if(w){this.connection.removeSignatureListener(N);return}w=!0,B(R)},"confirmed"),this.connection.getSignatureStatus(y)};return A(),{txIds:[],signedTxs:b}}else{let P=[];for(let x=0;x<b.length;x+=1){let A=await this.connection.sendTransaction(b[x],{skipPreflight:h});P.push(A)}return{txIds:P,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(t){var m;let f=t||{},{splitIns:n=[],computeBudgetConfig:r}=f,i=Ve(f,["splitIns","computeBudgetConfig"]),o=r?Ye(r):{instructions:[],instructionTypes:[]},s=this.signers.reduce((d,h)=>J(G({},d),{[h.publicKey.toBase58()]:h}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(d=>{let h=[...u,d],g=r?[...o.instructions,...h]:h,P=[...new Set(h.map(x=>x.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(x=>new xe(x));if(d!==n[l]&&u.length<12&&(Ne({instructions:g,payer:this.feePayer,signers:P})||Ne({instructions:h,payer:this.feePayer,signers:P})))u.push(d);else{if(u.length===0)throw Error("item ins too big");l+=d===n[l]?1:0,Ne({instructions:r?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:P})?a.push(new Me().add(...o.instructions,...u)):a.push(new Me().add(...u)),c.push(Array.from(new Set(u.map(x=>x.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat())).map(x=>s[x]).filter(x=>x!==void 0)),u=[d]}}),u.length>0){let h=[...new Set(u.map(g=>g.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(g=>s[g]).filter(g=>g!==void 0);Ne({instructions:r?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:h.map(g=>g.publicKey)})?a.push(new Me().add(...o.instructions,...u)):a.push(new Me().add(...u)),c.push(h)}return a.forEach(d=>d.feePayer=this.feePayer),(m=this.owner)!=null&&m.signer&&c.forEach(d=>{d.some(h=>h.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async d=>{var y;let{sequentially:h,onTxUpdate:g,skipTxCount:b=0,recentBlockHash:P,skipPreflight:x=!0}=d||{},A=P!=null?P:await we(this.connection,this.blockhashCommitment);if(a.forEach(async(w,T)=>{w.recentBlockhash=A,c[T].length&&w.sign(...c[T])}),pe(a),(y=this.owner)!=null&&y.isKeyPair){if(h){let w=0,T=[];for(let N of a){if(++w,w<=b){T.push("tx skipped");continue}let B=await Ct(this.connection,N,this.signers.find(R=>R.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:x});T.push(B)}return{txIds:T,signedTxs:a}}return{txIds:await Promise.all(a.map(async w=>await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:x}))),signedTxs:a}}if(this.signAllTransactions){let w=await this.signAllTransactions(a.slice(b,a.length)),T=[...a.slice(0,b),...w];if(h){let N=0,B=[],R=async()=>{if(!T[N])return;N<b&&(B.push({txId:"",status:"success",signedTx:T[N]}),g==null||g([...B]),N++,R());let O=await this.connection.sendRawTransaction(T[N].serialize(),{skipPreflight:x});B.push({txId:O,status:"sent",signedTx:T[N]}),g==null||g([...B]),N++;let v=!1,E=null,_=null,W=K=>{E!==null&&clearInterval(E),_!==null&&this.connection.removeSignatureListener(_);let L=B.findIndex(ce=>ce.txId===O);if(L>-1){if(B[L].status==="error"||B[L].status==="success")return;B[L].status=K.err?"error":"success"}g==null||g([...B]),K.err||R()};this.loopMultiTxStatus&&(E=setInterval(async()=>{var K;if(v){clearInterval(E);return}try{let L=await this.connection.getTransaction(O,{commitment:"confirmed",maxSupportedTransactionVersion:0});L&&(v=!0,clearInterval(E),W({err:((K=L.meta)==null?void 0:K.err)||null}),console.log("tx status from getTransaction:",O))}catch(L){v=!0,clearInterval(E),console.error("getTransaction timeout:",L,O)}},tt)),_=this.connection.onSignature(O,K=>{if(v){this.connection.removeSignatureListener(_);return}v=!0,W(K)},"confirmed"),this.connection.getSignatureStatus(O)};return await R(),{txIds:B.map(O=>O.txId),signedTxs:T}}else{let N=[];for(let B=0;B<T.length;B+=1){let R=await this.connection.sendRawTransaction(T[B].serialize(),{skipPreflight:x});N.push(R)}return{txIds:N,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(t){var A;let x=t||{},{computeBudgetConfig:n,splitIns:r=[],lookupTableCache:i={},lookupTableAddress:o=[]}=x,s=Ve(x,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=G(G({},this.cluster==="devnet"?await Bt(this.connection):et),i),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let y of c)a[y]===void 0&&u.push(new xe(y));let l=await It({connection:this.connection,address:u});for(let[y,w]of Object.entries(l))a[y]=w;let f=n?Ye(n):{instructions:[],instructionTypes:[]},m=await we(this.connection,this.blockhashCommitment),d=this.signers.reduce((y,w)=>J(G({},y),{[w.publicKey.toBase58()]:w}),{}),h=[],g=[],b=[],P=0;if(this.allInstructions.forEach(y=>{let w=[...b,y],T=n?[...f.instructions,...w]:w;if(y!==r[P]&&b.length<12&&(Re({instructions:T,payer:this.feePayer,lookupTableAddressAccount:a})||Re({instructions:w,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(y);else{if(b.length===0)throw Error("item ins too big");P+=y===r[P]?1:0;let N={};for(let B of[...new Set(c)])a[B]!==void 0&&(N[B]=a[B]);if(n&&Re({instructions:[...f.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let B=new De({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f.instructions,...b]}).compileToV0Message(Object.values(a));h.push(new Ee(B))}else{let B=new De({payerKey:this.feePayer,recentBlockhash:m,instructions:[...b]}).compileToV0Message(Object.values(a));h.push(new Ee(B))}g.push(Array.from(new Set(b.map(B=>B.keys.filter(R=>R.isSigner).map(R=>R.pubkey.toString())).flat())).map(B=>d[B]).filter(B=>B!==void 0)),b=[y]}}),b.length>0){let w=[...new Set(b.map(T=>T.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat()).values()].map(T=>d[T]).filter(T=>T!==void 0);if(n&&Re({instructions:[...f.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let T=new De({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f.instructions,...b]}).compileToV0Message(Object.values(a));h.push(new Ee(T))}else{let T=new De({payerKey:this.feePayer,recentBlockhash:m,instructions:[...b]}).compileToV0Message(Object.values(a));h.push(new Ee(T))}g.push(w)}return(A=this.owner)!=null&&A.signer&&g.forEach(y=>{y.some(w=>w.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),h.forEach((y,w)=>{y.sign(g[w])}),{builder:this,transactions:h,buildProps:t,signers:g,instructionTypes:this.instructionTypes,execute:async y=>{var O;let{sequentially:w,onTxUpdate:T,skipTxCount:N=0,recentBlockHash:B,skipPreflight:R=!0}=y||{};if(h.map(async(v,E)=>{g[E].length&&v.sign(g[E]),B&&(v.message.recentBlockhash=B)}),pe(h),(O=this.owner)!=null&&O.isKeyPair){if(w){let v=0,E=[];for(let _ of h){if(++v,v<=N){console.log("skip tx: ",v),E.push("tx skipped");continue}let W=await this.connection.sendTransaction(_,{skipPreflight:R});await $e(this.connection,W),E.push(W)}return{txIds:E,signedTxs:h}}return{txIds:await Promise.all(h.map(async v=>await this.connection.sendTransaction(v,{skipPreflight:R}))),signedTxs:h}}if(this.signAllTransactions){let v=await this.signAllTransactions(h.slice(N,h.length)),E=[...h.slice(0,N),...v];if(w){let _=0,W=[],K=async()=>{if(!E[_])return;if(_<N){W.push({txId:"",status:"success",signedTx:E[_]}),T==null||T([...W]),_++,K();return}let L=await this.connection.sendTransaction(E[_],{skipPreflight:R});W.push({txId:L,status:"sent",signedTx:E[_]}),T==null||T([...W]),_++;let ce=!1,de=null,Fe=null,Ot=le=>{de!==null&&clearInterval(de),Fe!==null&&this.connection.removeSignatureListener(Fe);let ee=W.findIndex(kn=>kn.txId===L);if(ee>-1){if(W[ee].status==="error"||W[ee].status==="success")return;W[ee].status=le.err?"error":"success"}T==null||T([...W]),le.err||K()};this.loopMultiTxStatus&&(de=setInterval(async()=>{var le;if(ce){clearInterval(de);return}try{let ee=await this.connection.getTransaction(L,{commitment:"confirmed",maxSupportedTransactionVersion:0});ee&&(ce=!0,clearInterval(de),Ot({err:((le=ee.meta)==null?void 0:le.err)||null}),console.log("tx status from getTransaction:",L))}catch(ee){ce=!0,clearInterval(de),console.error("getTransaction timeout:",ee,L)}},tt)),Fe=this.connection.onSignature(L,le=>{if(ce){this.connection.removeSignatureListener(Fe);return}ce=!0,Ot(le)},"confirmed"),this.connection.getSignatureStatus(L)};return K(),{txIds:[],signedTxs:E}}else{let _=[];for(let W=0;W<E.length;W+=1){let K=await this.connection.sendTransaction(E[W],{skipPreflight:R});_.push(K)}return{txIds:_,signedTxs:E}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import Xr from"bn.js";var da=new Xr(1e6);var Qr=Z("Raydium_amount"),Tn=Be(Jr);function Yr(e,t){let n="0",r="0";if(e.includes(".")){let i=e.split(".");i.length===2?([n,r]=i,r=r.padEnd(t,"0")):Qr.logWithError(`invalid number string, num: ${e}`)}else n=e;return[n,r.slice(0,t)||r]}var re=class extends F{constructor(n,r,i=!0,o){let s=new rt(0),a=xt.pow(new rt(n.decimals));if(i)s=X(r);else{let c=new rt(0),u=new rt(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[l,f]=Yr(r.toString(),n.decimals);c=X(l),u=X(f)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=Z(o||"TokenAmount"),this.token=n}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(n){return this.token.equals(n.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(n.raw)}lt(n){return this.token.equals(n.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(n.raw)}add(n){return this.token.equals(n.token)||this.logger.logWithError("add token not equals"),new re(this.token,this.raw.add(n.raw))}subtract(n){return this.token.equals(n.token)||this.logger.logWithError("sub token not equals"),new re(this.token,this.raw.sub(n.raw))}toSignificant(n=this.token.decimals,r,i=0){return super.toSignificant(n,r,i)}toFixed(n=this.token.decimals,r,i=0){return n>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(n,r,i)}toExact(n={groupSeparator:""}){return Tn.DP=this.token.decimals,new Tn(this.numerator.toString()).div(this.denominator.toString()).toFormat(n)}};function mn(e){return typeof e=="object"&&e!==null&&![me,re,$r,F,ei,ne,ye].some(t=>typeof t=="object"&&e instanceof t)}function it(e){return typeof e=="string"?ut(e):Array.isArray(e)?e.map(t=>it(t)):mn(e)?Object.fromEntries(Object.entries(e).map(([t,n])=>[t,it(n)])):e}var Lt=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),ve=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=Z(n)}createTxBuilder(t){return this.scope.checkOwner(),new nt({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(Lt(t))}logInfo(...t){this.logger.info(Lt(t))}logAndCreateError(...t){let n=Lt(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SYSVAR_CLOCK_PUBKEY as ii,TransactionInstruction as Et}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vt}from"@solana/spl-token";import{PublicKey as fc}from"@solana/web3.js";import pc,{isBN as dc}from"bn.js";import{bits as lu,BitStructure as fu,blob as mu,Blob as pu,cstr as du,f32 as gu,f32be as hu,f64 as bu,f64be as yu,greedy as wu,Layout as Tu,ns64 as Pu,ns64be as xu,nu64 as ti,nu64be as Au,offset as Su,s16 as ku,s16be as Iu,s24 as Bu,s24be as Cu,s32 as Lu,s32be as Nu,s40 as Ru,s40be as Mu,s48 as Du,s48be as Eu,s8 as vu,seq as _u,struct as Ou,Structure as ni,u16 as Fu,u16be as Ku,u24 as Vu,u24be as Wu,u32 as Uu,u32be as qu,u40 as Gu,u40be as ju,u48 as Hu,u48be as Zu,u8 as zu,UInt as ri,union as Xu,Union as Ju,unionLayoutDiscriminator as Qu,utf8 as Yu}from"@solana/buffer-layout";var Pn=ni;var xn=ri;var An=ti;function Rt(e){return new xn(1,e)}var Nt=class extends Pn{decode(t,n){return super.decode(t,n)}};function Mt(e,t,n){return new Nt(e,t,n)}var Dt=Mt([Rt("instruction"),An("amount")]),_e=Mt([Rt("instruction")]);function kc({programId:e,amount:t,instructionKeys:n}){let r=[{pubkey:Gt,isSigner:!1,isWritable:!1},{pubkey:vt,isSigner:!1,isWritable:!1},{pubkey:qt,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},...Object.entries(n).map(([o,s])=>({pubkey:s,isSigner:o==="userOwner",isWritable:!["authority","userOwner","userIdoCheck","userStakeInfo"].includes(o)}))],i=Buffer.alloc(Dt.span);return Dt.encode({instruction:1,amount:Number(t)},i),new Et({keys:r,programId:e,data:i})}function ot({programId:e},t){let n=[{pubkey:vt,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},...Object.entries(t).map(([i,o])=>({pubkey:o,isSigner:i==="userOwner",isWritable:!["authority","userOwner"].includes(i)}))],r=Buffer.alloc(_e.span);return _e.encode({instruction:2},r),new Et({keys:n,programId:e,data:r})}function _t(e){let{poolConfig:t,userKeys:n,side:r}=e,i=r==="base"?n.baseTokenAccount:n.quoteTokenAccount,o=r==="base"?t.baseVault:t.quoteVault,s=Buffer.alloc(_e.span);_e.encode({instruction:2},s);let a=[{pubkey:vt,isWritable:!1,isSigner:!1},{pubkey:ii,isWritable:!1,isSigner:!1},{pubkey:t.id,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!0,isSigner:!1},{pubkey:i,isWritable:!0,isSigner:!1},{pubkey:n.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:n.owner,isWritable:!1,isSigner:!0}];return new Et({programId:t.programId,keys:a,data:s})}var oi={[Ae.IDO_PROGRAM_ID_V1.toString()]:1,[Ae.IDO_PROGRAM_ID_V2.toString()]:2,[Ae.IDO_PROGRAM_ID_V3.toString()]:3,[Ae.IDO_PROGRAM_ID_V4.toString()]:4},st=class extends ve{async claim({ownerInfo:t,idoKeys:n,associatedOnly:r=!0,checkCreateATAOwner:i=!1,txVersion:o,feePayer:s}){let a=this.createTxBuilder(s),c=oi[n.programId];c||this.logAndCreateError("invalid version",c);let u=it(n),[l,f]=[!new Sn(t.coin).isZero(),!new Sn(t.pc).isZero()],m=u.projectInfo.mint.address.equals(ge),{account:d,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.projectInfo.mint.programId,mint:u.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!m,notUseTokenAccount:m,associatedOnly:m?!1:r,checkCreateATAOwner:i});!d&&l&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address),l&&h&&a.addInstruction(h);let g=u.buyInfo.mint.address.equals(ge),{account:b,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.buyInfo.mint.programId,mint:u.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,notUseTokenAccount:g,associatedOnly:g?!1:r,checkCreateATAOwner:i});if(!d&&f&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address),f&&P&&a.addInstruction(P),(!d||!b)&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address,n.buyInfo.mint.address),c===3)return a.addInstruction({instructions:[...l?[ot({programId:u.programId},{idoId:u.id,authority:u.authority,poolTokenAccount:u.projectInfo.vault,userTokenAccount:d,userIdoInfo:new Oe(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...f?[ot({programId:new Oe(n.programId)},{idoId:u.id,authority:u.authority,poolTokenAccount:u.buyInfo.vault,userTokenAccount:b,userIdoInfo:new Oe(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:o});if(c<3)return!l&&!f&&this.logAndCreateError("no claimable rewards"),a.addInstruction({instructions:[ot({programId:u.programId},{idoId:u.id,authority:u.authority,poolQuoteTokenAccount:u.buyInfo.vault,poolBaseTokenAccount:u.projectInfo.vault,userQuoteTokenAccount:b,userBaseTokenAccount:d,userIdoInfo:new Oe(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:o});let x={poolConfig:{id:u.id,programId:u.programId,authority:u.authority,baseVault:u.projectInfo.vault,quoteVault:u.buyInfo.vault,baseToken:n.projectInfo.mint,quoteToken:n.buyInfo.mint},userKeys:{baseTokenAccount:d,quoteTokenAccount:b,ledgerAccount:new Oe(t.userIdoInfo),owner:this.scope.ownerPubKey}};return a.addInstruction({instructions:[...l?[_t(J(G({},x),{side:"base"}))]:[],...f?[_t(J(G({},x),{side:"quote"}))]:[]]}).versionBuild({txVersion:o})}};export{_e as claimLayout,st as default,ot as makeClaimInstruction,_t as makeClaimInstructionV4,kc as makePurchaseInstruction,Dt as purchaseLayout};
//# sourceMappingURL=index.mjs.map